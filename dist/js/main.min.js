// поиск кнопки по идентификатору
var hamburgerButton = document.querySelector('#hamburger');

// поиск меню по идентификатору
var hamburgerMenu = document.querySelector('#hamburgerMenu');
let links = document.querySelectorAll('.menu__link');

// слушаем события на кнопке
// при клике снимаем и возвращаем активный класс на кнопку и меню

hamburgerButton.addEventListener('click', toggleMenu);

function toggleMenu(event) {
  event.preventDefault();
  hamburgerButton.classList.toggle('hamburger--active');
  hamburgerMenu.classList.toggle('menu--active');
};

links.forEach(function(element) {
  element.addEventListener('click', toggleMenu);
});

//Слайдер-карусель

const slider = $('.offers').bxSlider({
  pager: false,
  controls: false
});

$('.offers-slider__arrow--left').click(e => {
  e.preventDefault();

  slider.goToPrevSlide();
});

$('.offers-slider__arrow--right').click(e => {
  e.preventDefault();

  slider.goToNextSlide();
});

//Слайдшоу - переключение
const findBlockByAlias = (alias) => {
  return $(".reviews__item").filter((ndx, item) => {
    return $(item).attr("data-chain") === alias;
  });
};

$(".reviews-switcher__link").click((e) => {
  e.preventDefault();

  const $this = $(e.currentTarget);
  const target = $this.attr("data-open");
  const itemToShow = findBlockByAlias(target);
  const curItem = $this.closest(".reviews-switcher__item");

  itemToShow.addClass("active").siblings().removeClass("active");
  curItem.addClass("active").siblings().removeClass("active");
});

//Вертикальный аккордеон
const openItem = (item) => {
  const container = item.closest(".team__item");
  const contentBlock = container.find(".team__content");
  const textBlock = contentBlock.find(".team__content-block");
  const reqHeight = textBlock.height();

  container.addClass("active");
  contentBlock.height(reqHeight);
};

const closeEveryItem = (container) => {
  const items = container.find(".team__content");
  const itemContainer = container.find(".team__item");

  itemContainer.removeClass("active");
  items.height(0);
};

$('.team__title').click((e) => {
  const $this = $(e.currentTarget);
  const container = $this.closest('.team');
  const elemContainer = $this.closest(".team__item");
  
  if (elemContainer.hasClass("active")) {
    closeEveryItem(container);
  } else {
    closeEveryItem(container);
    openItem($this);
  }
}); 

//Форма
const validateFields = (form, fieldsArray) => {
  fieldsArray.forEach((field) => {
    field.removeClass("input-error");
    if (field.val().trim() === "") {
      field.addClass("input-error");
    }
  });

  const errorFields = form.find(".input-error");

  return errorFields.length === 0;
}

$(".form").submit(e => {
  e.preventDefault();

  const form = $(e.currentTarget);
  const name = form.find("[name='name']");
  const phone = form.find("[name='phone']");
  const comment = form.find("[name='comment']");
  const to = form.find("[name='to']");

  const modal = $("#modal");
  const content = modal.find(".modal__content");

  modal.removeClass("error-modal");

  const isValid = validateFields(form, [name, phone, comment, to]);

  if (isValid) {
    const request = $.ajax({
      url: "https://webdev-api.loftschool.com/sendmail",
      method: "post",
      data: {
        name: name.val(),
        phone: phone.val(),
        comment: comment.val(),
        to: to.val(),
      }
    });
    request.done((data) => {
      content.text(data.message);
    });
    request.fail((data) => {
      const message = data.responseJSON.message;
      content.text(message);
      modal.addClass("error-modal");
    });
    request.always(() => {
      $.fancybox.open({
        src: "#modal",
        type: "inline"
      });
    });
  }
});

$(".app-submit-btn").click(e => {
  e.preventDefault();

  $.fancybox.close();
});

//Горизонтальный аккордеон
const mesureWidth = (unit) => {
  let reqUnitWidth = 0;
  const screenWidth = $(window).width();
  const container = unit.closest(".products__list");
  const titlesBlocks = container.find(".product__title");
  const titlesWidth = titlesBlocks.width() * titlesBlocks.length;

  const textContainer = unit.find(".product__container");
  const paddingLeft = parseInt(textContainer.css("padding-left"));
  const paddingRight = parseInt(textContainer.css("padding-right"));

  const isTablet = window.matchMedia("(max-width: 768px)").matches;
  const isMobile = window.matchMedia("(max-width: 480px)").matches;
  
  if (isTablet) {
    reqUnitWidth = screenWidth - titlesWidth;
  } 
  if (isMobile) {
    reqUnitWidth = screenWidth - titlesBlocks.width();
  } 
  
  if (!isTablet && !isMobile) {
    reqUnitWidth = 524;
  }

  return {
    container: reqUnitWidth,
    textContainer: reqUnitWidth - paddingRight - paddingLeft
  }
};

//Смена заголовка в секции "Цвета" по клику на плашку
$('.product__title').click(function() {
  if (!$(this).data('status')) {
    $('.products__title').text('меню');
    $(this).data('status', true);
  } else {
    $('.products__title').text('цвета');
    $(this).data('status', false);
  }  
});

const closeEveryUnitInContainer = container => {
  const units = container.find(".products__item");
  const content = container.find(".product__content");

  units.removeClass("active");
  content.width(0);
};

const openUnit = (unit) => {
  const hiddenContent = unit.find(".product__content");
  const reqWidth = mesureWidth(unit);
  const textBlock = unit.find(".product__container");

  unit.addClass("active");
  hiddenContent.width(reqWidth.container);
  textBlock.width(reqWidth.textContainer);
};

$(".product__title").on("click", e => {
  e.preventDefault();

  const $this = $(e.currentTarget);
  const unit = $this.closest(".product");
  const unitOpened = unit.hasClass("active");
  const container = $this.closest(".products__list");

  if (unitOpened) {
    closeEveryUnitInContainer(container);
  } else {
    closeEveryUnitInContainer(container);
    openUnit(unit);
  }
});

//Видеоплеер
let video;
let durationControl;
let soundControl;
let intervalId;

// кнопки
const playBtn = document.querySelector(".video__player-img");
const soundBtn = document.querySelector(".sound");
const playerPlayBtn = document.querySelector(".duration__img");


video = document.getElementById("player");

// как только плеер загрузится
// video.addEventListener('loadeddata', function() {
    // вешаем обработчик события onclick на тег video
    video.addEventListener('click', playStop);

    // обработчики событий для кнопок play
    let playButtons = document.querySelectorAll(".play");
    for (let i = 0; i < playButtons.length; i++) {
        playButtons[i].addEventListener('click', playStop);
    }

    // обработчик событий для кнопки динамик
    let micControl = document.getElementById("mic");
    micControl.addEventListener('click', soundOf);

    // обработчики событий для ползунка продолжительности видео
    durationControl = document.getElementById("durationLevel");
    durationControl.addEventListener('input', setVideoDuration);

    durationControl.min = 0;
    durationControl.value = 0;
    // присваиваем ползунку продолжительности максимальное значение равное продолжительности нашего видео (в секундах)
    durationControl.max = video.duration;

    // обработчики событий для ползунка громокости
    soundControl = document.getElementById("micLevel");
    soundControl.addEventListener('input', changeSoundVolume);
    // soundControl.addEventListener('onmousemove', changeSoundVolume);

    // задаем максимальные и минимальные значения громокости
    soundControl.min = 0;
    soundControl.max = 10;
    // soundControl.step = 1;
    // присваиваем ползунку максимальное значение
    soundControl.value = soundControl.max;


    //обрабатываем окончание видео
    video.addEventListener('ended', function() {
        playBtn.classList.toggle("video__player-img--active");
        video.currentTime = 0;
        playerPlayBtn.classList.remove('active');
    });
// });



/*
 Воспроизведение видео
*/
function playStop() {
    // показывает или скрывает белую кнопку play
    playBtn.classList.toggle("video__player-img--active");

    // проверим стоит ли видео на паузе, если да то продолжим воспроизведение.

    if (video.paused) {
        // запускаем видео
        video.play();
        // Включаем функцию обновления прогресса
        intervalId = setInterval(updateDuration, 1000 / 60);
        // превращаем маленькую кнопку play в pause
        playerPlayBtn.classList.add('active');
        // Если, наоборот, проигрыавыется, то остановим.
    } else {
        // останавливаем видео
        video.pause();
        // останавливаем обновление прогресса
        clearInterval(intervalId);
        // превращаем маленькую кнопку pause в play
        playerPlayBtn.classList.remove('active');
    }
}

/*
    Реализует возможность перемотки нашего видео
*/
function setVideoDuration() {
    // установить значение ползунка в текущее время
    video.currentTime = durationControl.value;
    updateDuration();
    // intervalId = setInterval(updateDuration, 1000 / 60);
}


/*
  Функция для обновления позиции ползунка продолжительности видео.   
*/
function updateDuration() {
    // устанавливаем в наш инпут текущее время
    durationControl.value = video.currentTime;
    // рассчитываем процент для закраски прогресса
    let step = video.duration / 100;
    let percent = video.currentTime / step;
    // устанавливаем стили
    durationControl.style.background = `linear-gradient(90deg, #E01F3D 0%, #E01F3D ${percent}%, #626262 ${percent}%)`;

}


/*
    Управление звуком
*/
function soundOf() {
    /*
        Делаем проверку уровня громкости. 
        Если у нас нашего видео есть звук, то мы его выключаем. 
        Предварительно запомнив текущую позицию громкости в переменную soundLevel
    */
    if (video.volume === 0) {
        video.volume = soundLevel;
        soundControl.value = soundLevel * 10;
        soundBtn.classList.remove('active');
    } else {
        /*
            Если у нашего видео нет звука, то выставляем уровень громкости на прежний уровень.
            Хранится в перменной soundLevel
        */
        soundLevel = video.volume;
        video.volume = 0;
        soundControl.value = 0;
        soundBtn.classList.add('active');

    }
}

/*
    Управление звуком видео
*/
function changeSoundVolume() {
    /*
        Св-во volume может принимать значения от 0 до 1
        Делим на 10 для того что бы, была возможность более точной регулировки видео. 
   video.volume 0 .... 1 
   soundControl 0 .... 10
        */

    video.volume = soundControl.value / 10;
    if (video.volume == 0) {
        soundBtn.classList.add('active');
    } else {
        soundBtn.classList.remove('active');
    }
    console.log('значение volume у видео ' + video.volume);
    console.log('значение value у micLevel ' + soundControl.value / 10);
    /**У ползунка изначально задано минимальное значение 0 и максимальное 10 чтоб дать нам 10 положений
     * регулировки
     */
}

//Карта
let myMap;
const init = () => {
 myMap = new ymaps.Map("map", {
   center: [55.752132, 37.622807],
   zoom: 13,
   controls: [],
 });
 
 let coords = [
     [55.759211, 37.582637],
     [55.749662, 37.603889],
     [55.743069, 37.580987],
     [55.756917, 37.620619],
   ],
   myCollection = new ymaps.GeoObjectCollection({}, {
     draggable: false,
     iconLayout: 'default#image',
     iconImageHref: './img/icons/marker.svg',
     iconImageSize: [58, 73],
     iconImageOffset: [-35, -52]
   });
 
 for (let i = 0; i < coords.length; i++) {
   myCollection.add(new ymaps.Placemark(coords[i]));
 }
 
 myMap.geoObjects.add(myCollection);
 
 myMap.behaviors.disable('scrollZoom');
};
 
ymaps.ready(init);

//One page scroll
const sections = $("section");
const display = $(".maincontent");
const sideMenu = $(".fixed-menu");
const menuItems = sideMenu.find(".fixed-menu__item");

const mobileDetect = new MobileDetect(window.navigator.userAgent);
const isMobile = mobileDetect.mobile();

let inScroll = false;

sections.first().addClass("active");

const countSectionPosition = (sectionEq) => {
  const position = sectionEq * -100;

  if (isNaN(position)) {
    console.error("передано неверное значение в countSectionPosition");
    return 0;
  }
  
  return position;
};

const changeMenuThemeForSection = sectionEq => {
  const currentSection = sections.eq(sectionEq);
  const menuTheme = currentSection.attr("data-sidemenu-theme");
  const activeClass = "fixed-menu--shadowed";

  if (menuTheme === "black") {
    sideMenu.addClass(activeClass);
  } else {
    sideMenu.removeClass("fixed-menu--shadowed");
  }
};

const resetActiveClassForItem = (items, itemEq, activeClass) => {
  items.eq(itemEq).addClass(activeClass).siblings().removeClass(activeClass);
}

const performTransition = (sectionEq) => {
  if (inScroll) return;

  const transitionOver = 1000;
  const mouseInertiaOver = 300;

  inScroll = true;

  const position = countSectionPosition(sectionEq);

  changeMenuThemeForSection(sectionEq);

  display.css({
    transform: `translateY(${position}%)`
  });

  resetActiveClassForItem(sections, sectionEq, "active");

  setTimeout(() => {
    inScroll = false;

    resetActiveClassForItem(menuItems, sectionEq, "fixed-menu__item--active");
  }, transitionOver + mouseInertiaOver);
};

const viewportScroller = () => {
  const activeSection = sections.filter(".active");
  const nextSection = activeSection.next();
  const prevSection = activeSection.prev();

  return {
    next() {
      if (nextSection.length) {
        performTransition(nextSection.index())
      }
    },
    prev() {
      if (prevSection.length) {
        performTransition(prevSection.index())
      }
    },
  };
};

$(window).on("wheel", e => {
  const deltaY = e.originalEvent.deltaY;
  const scroller = viewportScroller();

  if (deltaY > 0) {
    scroller.next();
  }

  if (deltaY < 0) {
    scroller.prev();
  }
});

$(window).on("keydown", e => {
  const tagName = e.target.tagName.toLowerCase();
  const userTypingInInputs = tagName === "input" || tagName === "textarea";
  const scroller = viewportScroller();

  if (userTypingInInputs) return;

  switch (e.keyCode) {
    case 38: //prev
    scroller.prev();
      break;
  
    case 40: //next
      scroller.next();
      break;
  }
});

$(".wrapper").on("touchmove", e => e.preventDefault());

$("[data-scroll-to]").click(e => {
  e.preventDefault();

  const $this = $(e.currentTarget);
  const target = $this.attr("data-scroll-to");
  const reqSection = $(`[data-section-id=${target}]`);

  performTransition(reqSection.index());
})

if (isMobile) {
  $("body").swipe({
    swipe: function (event, direction) {
      const scroller = viewportScroller();
      let scrollDirection = "";
  
      if (direction === "up") scrollDirection = "next";
      if (direction === "down") scrollDirection = "prev";

      if (scrollDirection == "next" || scrollDirection == "prev") {
        scroller[scrollDirection]();  
      }
    }
  });
}
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImJlYXRzLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsImZpbGUiOiJtYWluLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8vINC/0L7QuNGB0Log0LrQvdC+0L/QutC4INC/0L4g0LjQtNC10L3RgtC40YTQuNC60LDRgtC+0YDRg1xyXG52YXIgaGFtYnVyZ2VyQnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI2hhbWJ1cmdlcicpO1xyXG5cclxuLy8g0L/QvtC40YHQuiDQvNC10L3RjiDQv9C+INC40LTQtdC90YLQuNGE0LjQutCw0YLQvtGA0YNcclxudmFyIGhhbWJ1cmdlck1lbnUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjaGFtYnVyZ2VyTWVudScpO1xyXG5sZXQgbGlua3MgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcubWVudV9fbGluaycpO1xyXG5cclxuLy8g0YHQu9GD0YjQsNC10Lwg0YHQvtCx0YvRgtC40Y8g0L3QsCDQutC90L7Qv9C60LVcclxuLy8g0L/RgNC4INC60LvQuNC60LUg0YHQvdC40LzQsNC10Lwg0Lgg0LLQvtC30LLRgNCw0YnQsNC10Lwg0LDQutGC0LjQstC90YvQuSDQutC70LDRgdGBINC90LAg0LrQvdC+0L/QutGDINC4INC80LXQvdGOXHJcblxyXG5oYW1idXJnZXJCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCB0b2dnbGVNZW51KTtcclxuXHJcbmZ1bmN0aW9uIHRvZ2dsZU1lbnUoZXZlbnQpIHtcclxuICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gIGhhbWJ1cmdlckJ1dHRvbi5jbGFzc0xpc3QudG9nZ2xlKCdoYW1idXJnZXItLWFjdGl2ZScpO1xyXG4gIGhhbWJ1cmdlck1lbnUuY2xhc3NMaXN0LnRvZ2dsZSgnbWVudS0tYWN0aXZlJyk7XHJcbn07XHJcblxyXG5saW5rcy5mb3JFYWNoKGZ1bmN0aW9uKGVsZW1lbnQpIHtcclxuICBlbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgdG9nZ2xlTWVudSk7XHJcbn0pO1xyXG5cclxuLy/QodC70LDQudC00LXRgC3QutCw0YDRg9GB0LXQu9GMXHJcblxyXG5jb25zdCBzbGlkZXIgPSAkKCcub2ZmZXJzJykuYnhTbGlkZXIoe1xyXG4gIHBhZ2VyOiBmYWxzZSxcclxuICBjb250cm9sczogZmFsc2VcclxufSk7XHJcblxyXG4kKCcub2ZmZXJzLXNsaWRlcl9fYXJyb3ctLWxlZnQnKS5jbGljayhlID0+IHtcclxuICBlLnByZXZlbnREZWZhdWx0KCk7XHJcblxyXG4gIHNsaWRlci5nb1RvUHJldlNsaWRlKCk7XHJcbn0pO1xyXG5cclxuJCgnLm9mZmVycy1zbGlkZXJfX2Fycm93LS1yaWdodCcpLmNsaWNrKGUgPT4ge1xyXG4gIGUucHJldmVudERlZmF1bHQoKTtcclxuXHJcbiAgc2xpZGVyLmdvVG9OZXh0U2xpZGUoKTtcclxufSk7XHJcblxyXG4vL9Ch0LvQsNC50LTRiNC+0YMgLSDQv9C10YDQtdC60LvRjtGH0LXQvdC40LVcclxuY29uc3QgZmluZEJsb2NrQnlBbGlhcyA9IChhbGlhcykgPT4ge1xyXG4gIHJldHVybiAkKFwiLnJldmlld3NfX2l0ZW1cIikuZmlsdGVyKChuZHgsIGl0ZW0pID0+IHtcclxuICAgIHJldHVybiAkKGl0ZW0pLmF0dHIoXCJkYXRhLWNoYWluXCIpID09PSBhbGlhcztcclxuICB9KTtcclxufTtcclxuXHJcbiQoXCIucmV2aWV3cy1zd2l0Y2hlcl9fbGlua1wiKS5jbGljaygoZSkgPT4ge1xyXG4gIGUucHJldmVudERlZmF1bHQoKTtcclxuXHJcbiAgY29uc3QgJHRoaXMgPSAkKGUuY3VycmVudFRhcmdldCk7XHJcbiAgY29uc3QgdGFyZ2V0ID0gJHRoaXMuYXR0cihcImRhdGEtb3BlblwiKTtcclxuICBjb25zdCBpdGVtVG9TaG93ID0gZmluZEJsb2NrQnlBbGlhcyh0YXJnZXQpO1xyXG4gIGNvbnN0IGN1ckl0ZW0gPSAkdGhpcy5jbG9zZXN0KFwiLnJldmlld3Mtc3dpdGNoZXJfX2l0ZW1cIik7XHJcblxyXG4gIGl0ZW1Ub1Nob3cuYWRkQ2xhc3MoXCJhY3RpdmVcIikuc2libGluZ3MoKS5yZW1vdmVDbGFzcyhcImFjdGl2ZVwiKTtcclxuICBjdXJJdGVtLmFkZENsYXNzKFwiYWN0aXZlXCIpLnNpYmxpbmdzKCkucmVtb3ZlQ2xhc3MoXCJhY3RpdmVcIik7XHJcbn0pO1xyXG5cclxuLy/QktC10YDRgtC40LrQsNC70YzQvdGL0Lkg0LDQutC60L7RgNC00LXQvtC9XHJcbmNvbnN0IG9wZW5JdGVtID0gKGl0ZW0pID0+IHtcclxuICBjb25zdCBjb250YWluZXIgPSBpdGVtLmNsb3Nlc3QoXCIudGVhbV9faXRlbVwiKTtcclxuICBjb25zdCBjb250ZW50QmxvY2sgPSBjb250YWluZXIuZmluZChcIi50ZWFtX19jb250ZW50XCIpO1xyXG4gIGNvbnN0IHRleHRCbG9jayA9IGNvbnRlbnRCbG9jay5maW5kKFwiLnRlYW1fX2NvbnRlbnQtYmxvY2tcIik7XHJcbiAgY29uc3QgcmVxSGVpZ2h0ID0gdGV4dEJsb2NrLmhlaWdodCgpO1xyXG5cclxuICBjb250YWluZXIuYWRkQ2xhc3MoXCJhY3RpdmVcIik7XHJcbiAgY29udGVudEJsb2NrLmhlaWdodChyZXFIZWlnaHQpO1xyXG59O1xyXG5cclxuY29uc3QgY2xvc2VFdmVyeUl0ZW0gPSAoY29udGFpbmVyKSA9PiB7XHJcbiAgY29uc3QgaXRlbXMgPSBjb250YWluZXIuZmluZChcIi50ZWFtX19jb250ZW50XCIpO1xyXG4gIGNvbnN0IGl0ZW1Db250YWluZXIgPSBjb250YWluZXIuZmluZChcIi50ZWFtX19pdGVtXCIpO1xyXG5cclxuICBpdGVtQ29udGFpbmVyLnJlbW92ZUNsYXNzKFwiYWN0aXZlXCIpO1xyXG4gIGl0ZW1zLmhlaWdodCgwKTtcclxufTtcclxuXHJcbiQoJy50ZWFtX190aXRsZScpLmNsaWNrKChlKSA9PiB7XHJcbiAgY29uc3QgJHRoaXMgPSAkKGUuY3VycmVudFRhcmdldCk7XHJcbiAgY29uc3QgY29udGFpbmVyID0gJHRoaXMuY2xvc2VzdCgnLnRlYW0nKTtcclxuICBjb25zdCBlbGVtQ29udGFpbmVyID0gJHRoaXMuY2xvc2VzdChcIi50ZWFtX19pdGVtXCIpO1xyXG4gIFxyXG4gIGlmIChlbGVtQ29udGFpbmVyLmhhc0NsYXNzKFwiYWN0aXZlXCIpKSB7XHJcbiAgICBjbG9zZUV2ZXJ5SXRlbShjb250YWluZXIpO1xyXG4gIH0gZWxzZSB7XHJcbiAgICBjbG9zZUV2ZXJ5SXRlbShjb250YWluZXIpO1xyXG4gICAgb3Blbkl0ZW0oJHRoaXMpO1xyXG4gIH1cclxufSk7IFxyXG5cclxuLy/QpNC+0YDQvNCwXHJcbmNvbnN0IHZhbGlkYXRlRmllbGRzID0gKGZvcm0sIGZpZWxkc0FycmF5KSA9PiB7XHJcbiAgZmllbGRzQXJyYXkuZm9yRWFjaCgoZmllbGQpID0+IHtcclxuICAgIGZpZWxkLnJlbW92ZUNsYXNzKFwiaW5wdXQtZXJyb3JcIik7XHJcbiAgICBpZiAoZmllbGQudmFsKCkudHJpbSgpID09PSBcIlwiKSB7XHJcbiAgICAgIGZpZWxkLmFkZENsYXNzKFwiaW5wdXQtZXJyb3JcIik7XHJcbiAgICB9XHJcbiAgfSk7XHJcblxyXG4gIGNvbnN0IGVycm9yRmllbGRzID0gZm9ybS5maW5kKFwiLmlucHV0LWVycm9yXCIpO1xyXG5cclxuICByZXR1cm4gZXJyb3JGaWVsZHMubGVuZ3RoID09PSAwO1xyXG59XHJcblxyXG4kKFwiLmZvcm1cIikuc3VibWl0KGUgPT4ge1xyXG4gIGUucHJldmVudERlZmF1bHQoKTtcclxuXHJcbiAgY29uc3QgZm9ybSA9ICQoZS5jdXJyZW50VGFyZ2V0KTtcclxuICBjb25zdCBuYW1lID0gZm9ybS5maW5kKFwiW25hbWU9J25hbWUnXVwiKTtcclxuICBjb25zdCBwaG9uZSA9IGZvcm0uZmluZChcIltuYW1lPSdwaG9uZSddXCIpO1xyXG4gIGNvbnN0IGNvbW1lbnQgPSBmb3JtLmZpbmQoXCJbbmFtZT0nY29tbWVudCddXCIpO1xyXG4gIGNvbnN0IHRvID0gZm9ybS5maW5kKFwiW25hbWU9J3RvJ11cIik7XHJcblxyXG4gIGNvbnN0IG1vZGFsID0gJChcIiNtb2RhbFwiKTtcclxuICBjb25zdCBjb250ZW50ID0gbW9kYWwuZmluZChcIi5tb2RhbF9fY29udGVudFwiKTtcclxuXHJcbiAgbW9kYWwucmVtb3ZlQ2xhc3MoXCJlcnJvci1tb2RhbFwiKTtcclxuXHJcbiAgY29uc3QgaXNWYWxpZCA9IHZhbGlkYXRlRmllbGRzKGZvcm0sIFtuYW1lLCBwaG9uZSwgY29tbWVudCwgdG9dKTtcclxuXHJcbiAgaWYgKGlzVmFsaWQpIHtcclxuICAgIGNvbnN0IHJlcXVlc3QgPSAkLmFqYXgoe1xyXG4gICAgICB1cmw6IFwiaHR0cHM6Ly93ZWJkZXYtYXBpLmxvZnRzY2hvb2wuY29tL3NlbmRtYWlsXCIsXHJcbiAgICAgIG1ldGhvZDogXCJwb3N0XCIsXHJcbiAgICAgIGRhdGE6IHtcclxuICAgICAgICBuYW1lOiBuYW1lLnZhbCgpLFxyXG4gICAgICAgIHBob25lOiBwaG9uZS52YWwoKSxcclxuICAgICAgICBjb21tZW50OiBjb21tZW50LnZhbCgpLFxyXG4gICAgICAgIHRvOiB0by52YWwoKSxcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgICByZXF1ZXN0LmRvbmUoKGRhdGEpID0+IHtcclxuICAgICAgY29udGVudC50ZXh0KGRhdGEubWVzc2FnZSk7XHJcbiAgICB9KTtcclxuICAgIHJlcXVlc3QuZmFpbCgoZGF0YSkgPT4ge1xyXG4gICAgICBjb25zdCBtZXNzYWdlID0gZGF0YS5yZXNwb25zZUpTT04ubWVzc2FnZTtcclxuICAgICAgY29udGVudC50ZXh0KG1lc3NhZ2UpO1xyXG4gICAgICBtb2RhbC5hZGRDbGFzcyhcImVycm9yLW1vZGFsXCIpO1xyXG4gICAgfSk7XHJcbiAgICByZXF1ZXN0LmFsd2F5cygoKSA9PiB7XHJcbiAgICAgICQuZmFuY3lib3gub3Blbih7XHJcbiAgICAgICAgc3JjOiBcIiNtb2RhbFwiLFxyXG4gICAgICAgIHR5cGU6IFwiaW5saW5lXCJcclxuICAgICAgfSk7XHJcbiAgICB9KTtcclxuICB9XHJcbn0pO1xyXG5cclxuJChcIi5hcHAtc3VibWl0LWJ0blwiKS5jbGljayhlID0+IHtcclxuICBlLnByZXZlbnREZWZhdWx0KCk7XHJcblxyXG4gICQuZmFuY3lib3guY2xvc2UoKTtcclxufSk7XHJcblxyXG4vL9CT0L7RgNC40LfQvtC90YLQsNC70YzQvdGL0Lkg0LDQutC60L7RgNC00LXQvtC9XHJcbmNvbnN0IG1lc3VyZVdpZHRoID0gKHVuaXQpID0+IHtcclxuICBsZXQgcmVxVW5pdFdpZHRoID0gMDtcclxuICBjb25zdCBzY3JlZW5XaWR0aCA9ICQod2luZG93KS53aWR0aCgpO1xyXG4gIGNvbnN0IGNvbnRhaW5lciA9IHVuaXQuY2xvc2VzdChcIi5wcm9kdWN0c19fbGlzdFwiKTtcclxuICBjb25zdCB0aXRsZXNCbG9ja3MgPSBjb250YWluZXIuZmluZChcIi5wcm9kdWN0X190aXRsZVwiKTtcclxuICBjb25zdCB0aXRsZXNXaWR0aCA9IHRpdGxlc0Jsb2Nrcy53aWR0aCgpICogdGl0bGVzQmxvY2tzLmxlbmd0aDtcclxuXHJcbiAgY29uc3QgdGV4dENvbnRhaW5lciA9IHVuaXQuZmluZChcIi5wcm9kdWN0X19jb250YWluZXJcIik7XHJcbiAgY29uc3QgcGFkZGluZ0xlZnQgPSBwYXJzZUludCh0ZXh0Q29udGFpbmVyLmNzcyhcInBhZGRpbmctbGVmdFwiKSk7XHJcbiAgY29uc3QgcGFkZGluZ1JpZ2h0ID0gcGFyc2VJbnQodGV4dENvbnRhaW5lci5jc3MoXCJwYWRkaW5nLXJpZ2h0XCIpKTtcclxuXHJcbiAgY29uc3QgaXNUYWJsZXQgPSB3aW5kb3cubWF0Y2hNZWRpYShcIihtYXgtd2lkdGg6IDc2OHB4KVwiKS5tYXRjaGVzO1xyXG4gIGNvbnN0IGlzTW9iaWxlID0gd2luZG93Lm1hdGNoTWVkaWEoXCIobWF4LXdpZHRoOiA0ODBweClcIikubWF0Y2hlcztcclxuICBcclxuICBpZiAoaXNUYWJsZXQpIHtcclxuICAgIHJlcVVuaXRXaWR0aCA9IHNjcmVlbldpZHRoIC0gdGl0bGVzV2lkdGg7XHJcbiAgfSBcclxuICBpZiAoaXNNb2JpbGUpIHtcclxuICAgIHJlcVVuaXRXaWR0aCA9IHNjcmVlbldpZHRoIC0gdGl0bGVzQmxvY2tzLndpZHRoKCk7XHJcbiAgfSBcclxuICBcclxuICBpZiAoIWlzVGFibGV0ICYmICFpc01vYmlsZSkge1xyXG4gICAgcmVxVW5pdFdpZHRoID0gNTI0O1xyXG4gIH1cclxuXHJcbiAgcmV0dXJuIHtcclxuICAgIGNvbnRhaW5lcjogcmVxVW5pdFdpZHRoLFxyXG4gICAgdGV4dENvbnRhaW5lcjogcmVxVW5pdFdpZHRoIC0gcGFkZGluZ1JpZ2h0IC0gcGFkZGluZ0xlZnRcclxuICB9XHJcbn07XHJcblxyXG4vL9Ch0LzQtdC90LAg0LfQsNCz0L7Qu9C+0LLQutCwINCyINGB0LXQutGG0LjQuCBcItCm0LLQtdGC0LBcIiDQv9C+INC60LvQuNC60YMg0L3QsCDQv9C70LDRiNC60YNcclxuJCgnLnByb2R1Y3RfX3RpdGxlJykuY2xpY2soZnVuY3Rpb24oKSB7XHJcbiAgaWYgKCEkKHRoaXMpLmRhdGEoJ3N0YXR1cycpKSB7XHJcbiAgICAkKCcucHJvZHVjdHNfX3RpdGxlJykudGV4dCgn0LzQtdC90Y4nKTtcclxuICAgICQodGhpcykuZGF0YSgnc3RhdHVzJywgdHJ1ZSk7XHJcbiAgfSBlbHNlIHtcclxuICAgICQoJy5wcm9kdWN0c19fdGl0bGUnKS50ZXh0KCfRhtCy0LXRgtCwJyk7XHJcbiAgICAkKHRoaXMpLmRhdGEoJ3N0YXR1cycsIGZhbHNlKTtcclxuICB9ICBcclxufSk7XHJcblxyXG5jb25zdCBjbG9zZUV2ZXJ5VW5pdEluQ29udGFpbmVyID0gY29udGFpbmVyID0+IHtcclxuICBjb25zdCB1bml0cyA9IGNvbnRhaW5lci5maW5kKFwiLnByb2R1Y3RzX19pdGVtXCIpO1xyXG4gIGNvbnN0IGNvbnRlbnQgPSBjb250YWluZXIuZmluZChcIi5wcm9kdWN0X19jb250ZW50XCIpO1xyXG5cclxuICB1bml0cy5yZW1vdmVDbGFzcyhcImFjdGl2ZVwiKTtcclxuICBjb250ZW50LndpZHRoKDApO1xyXG59O1xyXG5cclxuY29uc3Qgb3BlblVuaXQgPSAodW5pdCkgPT4ge1xyXG4gIGNvbnN0IGhpZGRlbkNvbnRlbnQgPSB1bml0LmZpbmQoXCIucHJvZHVjdF9fY29udGVudFwiKTtcclxuICBjb25zdCByZXFXaWR0aCA9IG1lc3VyZVdpZHRoKHVuaXQpO1xyXG4gIGNvbnN0IHRleHRCbG9jayA9IHVuaXQuZmluZChcIi5wcm9kdWN0X19jb250YWluZXJcIik7XHJcblxyXG4gIHVuaXQuYWRkQ2xhc3MoXCJhY3RpdmVcIik7XHJcbiAgaGlkZGVuQ29udGVudC53aWR0aChyZXFXaWR0aC5jb250YWluZXIpO1xyXG4gIHRleHRCbG9jay53aWR0aChyZXFXaWR0aC50ZXh0Q29udGFpbmVyKTtcclxufTtcclxuXHJcbiQoXCIucHJvZHVjdF9fdGl0bGVcIikub24oXCJjbGlja1wiLCBlID0+IHtcclxuICBlLnByZXZlbnREZWZhdWx0KCk7XHJcblxyXG4gIGNvbnN0ICR0aGlzID0gJChlLmN1cnJlbnRUYXJnZXQpO1xyXG4gIGNvbnN0IHVuaXQgPSAkdGhpcy5jbG9zZXN0KFwiLnByb2R1Y3RcIik7XHJcbiAgY29uc3QgdW5pdE9wZW5lZCA9IHVuaXQuaGFzQ2xhc3MoXCJhY3RpdmVcIik7XHJcbiAgY29uc3QgY29udGFpbmVyID0gJHRoaXMuY2xvc2VzdChcIi5wcm9kdWN0c19fbGlzdFwiKTtcclxuXHJcbiAgaWYgKHVuaXRPcGVuZWQpIHtcclxuICAgIGNsb3NlRXZlcnlVbml0SW5Db250YWluZXIoY29udGFpbmVyKTtcclxuICB9IGVsc2Uge1xyXG4gICAgY2xvc2VFdmVyeVVuaXRJbkNvbnRhaW5lcihjb250YWluZXIpO1xyXG4gICAgb3BlblVuaXQodW5pdCk7XHJcbiAgfVxyXG59KTtcclxuXHJcbi8v0JLQuNC00LXQvtC/0LvQtdC10YBcclxubGV0IHZpZGVvO1xyXG5sZXQgZHVyYXRpb25Db250cm9sO1xyXG5sZXQgc291bmRDb250cm9sO1xyXG5sZXQgaW50ZXJ2YWxJZDtcclxuXHJcbi8vINC60L3QvtC/0LrQuFxyXG5jb25zdCBwbGF5QnRuID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi52aWRlb19fcGxheWVyLWltZ1wiKTtcclxuY29uc3Qgc291bmRCdG4gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnNvdW5kXCIpO1xyXG5jb25zdCBwbGF5ZXJQbGF5QnRuID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5kdXJhdGlvbl9faW1nXCIpO1xyXG5cclxuXHJcbnZpZGVvID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJwbGF5ZXJcIik7XHJcblxyXG4vLyDQutCw0Log0YLQvtC70YzQutC+INC/0LvQtdC10YAg0LfQsNCz0YDRg9C30LjRgtGB0Y9cclxuLy8gdmlkZW8uYWRkRXZlbnRMaXN0ZW5lcignbG9hZGVkZGF0YScsIGZ1bmN0aW9uKCkge1xyXG4gICAgLy8g0LLQtdGI0LDQtdC8INC+0LHRgNCw0LHQvtGC0YfQuNC6INGB0L7QsdGL0YLQuNGPIG9uY2xpY2sg0L3QsCDRgtC10LMgdmlkZW9cclxuICAgIHZpZGVvLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgcGxheVN0b3ApO1xyXG5cclxuICAgIC8vINC+0LHRgNCw0LHQvtGC0YfQuNC60Lgg0YHQvtCx0YvRgtC40Lkg0LTQu9GPINC60L3QvtC/0L7QuiBwbGF5XHJcbiAgICBsZXQgcGxheUJ1dHRvbnMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiLnBsYXlcIik7XHJcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHBsYXlCdXR0b25zLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgcGxheUJ1dHRvbnNbaV0uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBwbGF5U3RvcCk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8g0L7QsdGA0LDQsdC+0YLRh9C40Log0YHQvtCx0YvRgtC40Lkg0LTQu9GPINC60L3QvtC/0LrQuCDQtNC40L3QsNC80LjQulxyXG4gICAgbGV0IG1pY0NvbnRyb2wgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcIm1pY1wiKTtcclxuICAgIG1pY0NvbnRyb2wuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBzb3VuZE9mKTtcclxuXHJcbiAgICAvLyDQvtCx0YDQsNCx0L7RgtGH0LjQutC4INGB0L7QsdGL0YLQuNC5INC00LvRjyDQv9C+0LvQt9GD0L3QutCwINC/0YDQvtC00L7Qu9C20LjRgtC10LvRjNC90L7RgdGC0Lgg0LLQuNC00LXQvlxyXG4gICAgZHVyYXRpb25Db250cm9sID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJkdXJhdGlvbkxldmVsXCIpO1xyXG4gICAgZHVyYXRpb25Db250cm9sLmFkZEV2ZW50TGlzdGVuZXIoJ2lucHV0Jywgc2V0VmlkZW9EdXJhdGlvbik7XHJcblxyXG4gICAgZHVyYXRpb25Db250cm9sLm1pbiA9IDA7XHJcbiAgICBkdXJhdGlvbkNvbnRyb2wudmFsdWUgPSAwO1xyXG4gICAgLy8g0L/RgNC40YHQstCw0LjQstCw0LXQvCDQv9C+0LvQt9GD0L3QutGDINC/0YDQvtC00L7Qu9C20LjRgtC10LvRjNC90L7RgdGC0Lgg0LzQsNC60YHQuNC80LDQu9GM0L3QvtC1INC30L3QsNGH0LXQvdC40LUg0YDQsNCy0L3QvtC1INC/0YDQvtC00L7Qu9C20LjRgtC10LvRjNC90L7RgdGC0Lgg0L3QsNGI0LXQs9C+INCy0LjQtNC10L4gKNCyINGB0LXQutGD0L3QtNCw0YUpXHJcbiAgICBkdXJhdGlvbkNvbnRyb2wubWF4ID0gdmlkZW8uZHVyYXRpb247XHJcblxyXG4gICAgLy8g0L7QsdGA0LDQsdC+0YLRh9C40LrQuCDRgdC+0LHRi9GC0LjQuSDQtNC70Y8g0L/QvtC70LfRg9C90LrQsCDQs9GA0L7QvNC+0LrQvtGB0YLQuFxyXG4gICAgc291bmRDb250cm9sID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJtaWNMZXZlbFwiKTtcclxuICAgIHNvdW5kQ29udHJvbC5hZGRFdmVudExpc3RlbmVyKCdpbnB1dCcsIGNoYW5nZVNvdW5kVm9sdW1lKTtcclxuICAgIC8vIHNvdW5kQ29udHJvbC5hZGRFdmVudExpc3RlbmVyKCdvbm1vdXNlbW92ZScsIGNoYW5nZVNvdW5kVm9sdW1lKTtcclxuXHJcbiAgICAvLyDQt9Cw0LTQsNC10Lwg0LzQsNC60YHQuNC80LDQu9GM0L3Ri9C1INC4INC80LjQvdC40LzQsNC70YzQvdGL0LUg0LfQvdCw0YfQtdC90LjRjyDQs9GA0L7QvNC+0LrQvtGB0YLQuFxyXG4gICAgc291bmRDb250cm9sLm1pbiA9IDA7XHJcbiAgICBzb3VuZENvbnRyb2wubWF4ID0gMTA7XHJcbiAgICAvLyBzb3VuZENvbnRyb2wuc3RlcCA9IDE7XHJcbiAgICAvLyDQv9GA0LjRgdCy0LDQuNCy0LDQtdC8INC/0L7Qu9C30YPQvdC60YMg0LzQsNC60YHQuNC80LDQu9GM0L3QvtC1INC30L3QsNGH0LXQvdC40LVcclxuICAgIHNvdW5kQ29udHJvbC52YWx1ZSA9IHNvdW5kQ29udHJvbC5tYXg7XHJcblxyXG5cclxuICAgIC8v0L7QsdGA0LDQsdCw0YLRi9Cy0LDQtdC8INC+0LrQvtC90YfQsNC90LjQtSDQstC40LTQtdC+XHJcbiAgICB2aWRlby5hZGRFdmVudExpc3RlbmVyKCdlbmRlZCcsIGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIHBsYXlCdG4uY2xhc3NMaXN0LnRvZ2dsZShcInZpZGVvX19wbGF5ZXItaW1nLS1hY3RpdmVcIik7XHJcbiAgICAgICAgdmlkZW8uY3VycmVudFRpbWUgPSAwO1xyXG4gICAgICAgIHBsYXllclBsYXlCdG4uY2xhc3NMaXN0LnJlbW92ZSgnYWN0aXZlJyk7XHJcbiAgICB9KTtcclxuLy8gfSk7XHJcblxyXG5cclxuXHJcbi8qXHJcbiDQktC+0YHQv9GA0L7QuNC30LLQtdC00LXQvdC40LUg0LLQuNC00LXQvlxyXG4qL1xyXG5mdW5jdGlvbiBwbGF5U3RvcCgpIHtcclxuICAgIC8vINC/0L7QutCw0LfRi9Cy0LDQtdGCINC40LvQuCDRgdC60YDRi9Cy0LDQtdGCINCx0LXQu9GD0Y4g0LrQvdC+0L/QutGDIHBsYXlcclxuICAgIHBsYXlCdG4uY2xhc3NMaXN0LnRvZ2dsZShcInZpZGVvX19wbGF5ZXItaW1nLS1hY3RpdmVcIik7XHJcblxyXG4gICAgLy8g0L/RgNC+0LLQtdGA0LjQvCDRgdGC0L7QuNGCINC70Lgg0LLQuNC00LXQviDQvdCwINC/0LDRg9C30LUsINC10YHQu9C4INC00LAg0YLQviDQv9GA0L7QtNC+0LvQttC40Lwg0LLQvtGB0L/RgNC+0LjQt9Cy0LXQtNC10L3QuNC1LlxyXG5cclxuICAgIGlmICh2aWRlby5wYXVzZWQpIHtcclxuICAgICAgICAvLyDQt9Cw0L/Rg9GB0LrQsNC10Lwg0LLQuNC00LXQvlxyXG4gICAgICAgIHZpZGVvLnBsYXkoKTtcclxuICAgICAgICAvLyDQktC60LvRjtGH0LDQtdC8INGE0YPQvdC60YbQuNGOINC+0LHQvdC+0LLQu9C10L3QuNGPINC/0YDQvtCz0YDQtdGB0YHQsFxyXG4gICAgICAgIGludGVydmFsSWQgPSBzZXRJbnRlcnZhbCh1cGRhdGVEdXJhdGlvbiwgMTAwMCAvIDYwKTtcclxuICAgICAgICAvLyDQv9GA0LXQstGA0LDRidCw0LXQvCDQvNCw0LvQtdC90YzQutGD0Y4g0LrQvdC+0L/QutGDIHBsYXkg0LIgcGF1c2VcclxuICAgICAgICBwbGF5ZXJQbGF5QnRuLmNsYXNzTGlzdC5hZGQoJ2FjdGl2ZScpO1xyXG4gICAgICAgIC8vINCV0YHQu9C4LCDQvdCw0L7QsdC+0YDQvtGCLCDQv9GA0L7QuNCz0YDRi9Cw0LLRi9C10YLRgdGPLCDRgtC+INC+0YHRgtCw0L3QvtCy0LjQvC5cclxuICAgIH0gZWxzZSB7XHJcbiAgICAgICAgLy8g0L7RgdGC0LDQvdCw0LLQu9C40LLQsNC10Lwg0LLQuNC00LXQvlxyXG4gICAgICAgIHZpZGVvLnBhdXNlKCk7XHJcbiAgICAgICAgLy8g0L7RgdGC0LDQvdCw0LLQu9C40LLQsNC10Lwg0L7QsdC90L7QstC70LXQvdC40LUg0L/RgNC+0LPRgNC10YHRgdCwXHJcbiAgICAgICAgY2xlYXJJbnRlcnZhbChpbnRlcnZhbElkKTtcclxuICAgICAgICAvLyDQv9GA0LXQstGA0LDRidCw0LXQvCDQvNCw0LvQtdC90YzQutGD0Y4g0LrQvdC+0L/QutGDIHBhdXNlINCyIHBsYXlcclxuICAgICAgICBwbGF5ZXJQbGF5QnRuLmNsYXNzTGlzdC5yZW1vdmUoJ2FjdGl2ZScpO1xyXG4gICAgfVxyXG59XHJcblxyXG4vKlxyXG4gICAg0KDQtdCw0LvQuNC30YPQtdGCINCy0L7Qt9C80L7QttC90L7RgdGC0Ywg0L/QtdGA0LXQvNC+0YLQutC4INC90LDRiNC10LPQviDQstC40LTQtdC+XHJcbiovXHJcbmZ1bmN0aW9uIHNldFZpZGVvRHVyYXRpb24oKSB7XHJcbiAgICAvLyDRg9GB0YLQsNC90L7QstC40YLRjCDQt9C90LDRh9C10L3QuNC1INC/0L7Qu9C30YPQvdC60LAg0LIg0YLQtdC60YPRidC10LUg0LLRgNC10LzRj1xyXG4gICAgdmlkZW8uY3VycmVudFRpbWUgPSBkdXJhdGlvbkNvbnRyb2wudmFsdWU7XHJcbiAgICB1cGRhdGVEdXJhdGlvbigpO1xyXG4gICAgLy8gaW50ZXJ2YWxJZCA9IHNldEludGVydmFsKHVwZGF0ZUR1cmF0aW9uLCAxMDAwIC8gNjApO1xyXG59XHJcblxyXG5cclxuLypcclxuICDQpNGD0L3QutGG0LjRjyDQtNC70Y8g0L7QsdC90L7QstC70LXQvdC40Y8g0L/QvtC30LjRhtC40Lgg0L/QvtC70LfRg9C90LrQsCDQv9GA0L7QtNC+0LvQttC40YLQtdC70YzQvdC+0YHRgtC4INCy0LjQtNC10L4uICAgXHJcbiovXHJcbmZ1bmN0aW9uIHVwZGF0ZUR1cmF0aW9uKCkge1xyXG4gICAgLy8g0YPRgdGC0LDQvdCw0LLQu9C40LLQsNC10Lwg0LIg0L3QsNGIINC40L3Qv9GD0YIg0YLQtdC60YPRidC10LUg0LLRgNC10LzRj1xyXG4gICAgZHVyYXRpb25Db250cm9sLnZhbHVlID0gdmlkZW8uY3VycmVudFRpbWU7XHJcbiAgICAvLyDRgNCw0YHRgdGH0LjRgtGL0LLQsNC10Lwg0L/RgNC+0YbQtdC90YIg0LTQu9GPINC30LDQutGA0LDRgdC60Lgg0L/RgNC+0LPRgNC10YHRgdCwXHJcbiAgICBsZXQgc3RlcCA9IHZpZGVvLmR1cmF0aW9uIC8gMTAwO1xyXG4gICAgbGV0IHBlcmNlbnQgPSB2aWRlby5jdXJyZW50VGltZSAvIHN0ZXA7XHJcbiAgICAvLyDRg9GB0YLQsNC90LDQstC70LjQstCw0LXQvCDRgdGC0LjQu9C4XHJcbiAgICBkdXJhdGlvbkNvbnRyb2wuc3R5bGUuYmFja2dyb3VuZCA9IGBsaW5lYXItZ3JhZGllbnQoOTBkZWcsICNFMDFGM0QgMCUsICNFMDFGM0QgJHtwZXJjZW50fSUsICM2MjYyNjIgJHtwZXJjZW50fSUpYDtcclxuXHJcbn1cclxuXHJcblxyXG4vKlxyXG4gICAg0KPQv9GA0LDQstC70LXQvdC40LUg0LfQstGD0LrQvtC8XHJcbiovXHJcbmZ1bmN0aW9uIHNvdW5kT2YoKSB7XHJcbiAgICAvKlxyXG4gICAgICAgINCU0LXQu9Cw0LXQvCDQv9GA0L7QstC10YDQutGDINGD0YDQvtCy0L3RjyDQs9GA0L7QvNC60L7RgdGC0LguIFxyXG4gICAgICAgINCV0YHQu9C4INGDINC90LDRgSDQvdCw0YjQtdCz0L4g0LLQuNC00LXQviDQtdGB0YLRjCDQt9Cy0YPQuiwg0YLQviDQvNGLINC10LPQviDQstGL0LrQu9GO0YfQsNC10LwuIFxyXG4gICAgICAgINCf0YDQtdC00LLQsNGA0LjRgtC10LvRjNC90L4g0LfQsNC/0L7QvNC90LjQsiDRgtC10LrRg9GJ0YPRjiDQv9C+0LfQuNGG0LjRjiDQs9GA0L7QvNC60L7RgdGC0Lgg0LIg0L/QtdGA0LXQvNC10L3QvdGD0Y4gc291bmRMZXZlbFxyXG4gICAgKi9cclxuICAgIGlmICh2aWRlby52b2x1bWUgPT09IDApIHtcclxuICAgICAgICB2aWRlby52b2x1bWUgPSBzb3VuZExldmVsO1xyXG4gICAgICAgIHNvdW5kQ29udHJvbC52YWx1ZSA9IHNvdW5kTGV2ZWwgKiAxMDtcclxuICAgICAgICBzb3VuZEJ0bi5jbGFzc0xpc3QucmVtb3ZlKCdhY3RpdmUnKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgICAgLypcclxuICAgICAgICAgICAg0JXRgdC70Lgg0YMg0L3QsNGI0LXQs9C+INCy0LjQtNC10L4g0L3QtdGCINC30LLRg9C60LAsINGC0L4g0LLRi9GB0YLQsNCy0LvRj9C10Lwg0YPRgNC+0LLQtdC90Ywg0LPRgNC+0LzQutC+0YHRgtC4INC90LAg0L/RgNC10LbQvdC40Lkg0YPRgNC+0LLQtdC90YwuXHJcbiAgICAgICAgICAgINCl0YDQsNC90LjRgtGB0Y8g0LIg0L/QtdGA0LzQtdC90L3QvtC5IHNvdW5kTGV2ZWxcclxuICAgICAgICAqL1xyXG4gICAgICAgIHNvdW5kTGV2ZWwgPSB2aWRlby52b2x1bWU7XHJcbiAgICAgICAgdmlkZW8udm9sdW1lID0gMDtcclxuICAgICAgICBzb3VuZENvbnRyb2wudmFsdWUgPSAwO1xyXG4gICAgICAgIHNvdW5kQnRuLmNsYXNzTGlzdC5hZGQoJ2FjdGl2ZScpO1xyXG5cclxuICAgIH1cclxufVxyXG5cclxuLypcclxuICAgINCj0L/RgNCw0LLQu9C10L3QuNC1INC30LLRg9C60L7QvCDQstC40LTQtdC+XHJcbiovXHJcbmZ1bmN0aW9uIGNoYW5nZVNvdW5kVm9sdW1lKCkge1xyXG4gICAgLypcclxuICAgICAgICDQodCyLdCy0L4gdm9sdW1lINC80L7QttC10YIg0L/RgNC40L3QuNC80LDRgtGMINC30L3QsNGH0LXQvdC40Y8g0L7RgiAwINC00L4gMVxyXG4gICAgICAgINCU0LXQu9C40Lwg0L3QsCAxMCDQtNC70Y8g0YLQvtCz0L4g0YfRgtC+INCx0YssINCx0YvQu9CwINCy0L7Qt9C80L7QttC90L7RgdGC0Ywg0LHQvtC70LXQtSDRgtC+0YfQvdC+0Lkg0YDQtdCz0YPQu9C40YDQvtCy0LrQuCDQstC40LTQtdC+LiBcclxuICAgdmlkZW8udm9sdW1lIDAgLi4uLiAxIFxyXG4gICBzb3VuZENvbnRyb2wgMCAuLi4uIDEwXHJcbiAgICAgICAgKi9cclxuXHJcbiAgICB2aWRlby52b2x1bWUgPSBzb3VuZENvbnRyb2wudmFsdWUgLyAxMDtcclxuICAgIGlmICh2aWRlby52b2x1bWUgPT0gMCkge1xyXG4gICAgICAgIHNvdW5kQnRuLmNsYXNzTGlzdC5hZGQoJ2FjdGl2ZScpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgICBzb3VuZEJ0bi5jbGFzc0xpc3QucmVtb3ZlKCdhY3RpdmUnKTtcclxuICAgIH1cclxuICAgIGNvbnNvbGUubG9nKCfQt9C90LDRh9C10L3QuNC1IHZvbHVtZSDRgyDQstC40LTQtdC+ICcgKyB2aWRlby52b2x1bWUpO1xyXG4gICAgY29uc29sZS5sb2coJ9C30L3QsNGH0LXQvdC40LUgdmFsdWUg0YMgbWljTGV2ZWwgJyArIHNvdW5kQ29udHJvbC52YWx1ZSAvIDEwKTtcclxuICAgIC8qKtCjINC/0L7Qu9C30YPQvdC60LAg0LjQt9C90LDRh9Cw0LvRjNC90L4g0LfQsNC00LDQvdC+INC80LjQvdC40LzQsNC70YzQvdC+0LUg0LfQvdCw0YfQtdC90LjQtSAwINC4INC80LDQutGB0LjQvNCw0LvRjNC90L7QtSAxMCDRh9GC0L7QsSDQtNCw0YLRjCDQvdCw0LwgMTAg0L/QvtC70L7QttC10L3QuNC5XHJcbiAgICAgKiDRgNC10LPRg9C70LjRgNC+0LLQutC4XHJcbiAgICAgKi9cclxufVxyXG5cclxuLy/QmtCw0YDRgtCwXHJcbmxldCBteU1hcDtcclxuY29uc3QgaW5pdCA9ICgpID0+IHtcclxuIG15TWFwID0gbmV3IHltYXBzLk1hcChcIm1hcFwiLCB7XHJcbiAgIGNlbnRlcjogWzU1Ljc1MjEzMiwgMzcuNjIyODA3XSxcclxuICAgem9vbTogMTMsXHJcbiAgIGNvbnRyb2xzOiBbXSxcclxuIH0pO1xyXG4gXHJcbiBsZXQgY29vcmRzID0gW1xyXG4gICAgIFs1NS43NTkyMTEsIDM3LjU4MjYzN10sXHJcbiAgICAgWzU1Ljc0OTY2MiwgMzcuNjAzODg5XSxcclxuICAgICBbNTUuNzQzMDY5LCAzNy41ODA5ODddLFxyXG4gICAgIFs1NS43NTY5MTcsIDM3LjYyMDYxOV0sXHJcbiAgIF0sXHJcbiAgIG15Q29sbGVjdGlvbiA9IG5ldyB5bWFwcy5HZW9PYmplY3RDb2xsZWN0aW9uKHt9LCB7XHJcbiAgICAgZHJhZ2dhYmxlOiBmYWxzZSxcclxuICAgICBpY29uTGF5b3V0OiAnZGVmYXVsdCNpbWFnZScsXHJcbiAgICAgaWNvbkltYWdlSHJlZjogJy4vaW1nL2ljb25zL21hcmtlci5zdmcnLFxyXG4gICAgIGljb25JbWFnZVNpemU6IFs1OCwgNzNdLFxyXG4gICAgIGljb25JbWFnZU9mZnNldDogWy0zNSwgLTUyXVxyXG4gICB9KTtcclxuIFxyXG4gZm9yIChsZXQgaSA9IDA7IGkgPCBjb29yZHMubGVuZ3RoOyBpKyspIHtcclxuICAgbXlDb2xsZWN0aW9uLmFkZChuZXcgeW1hcHMuUGxhY2VtYXJrKGNvb3Jkc1tpXSkpO1xyXG4gfVxyXG4gXHJcbiBteU1hcC5nZW9PYmplY3RzLmFkZChteUNvbGxlY3Rpb24pO1xyXG4gXHJcbiBteU1hcC5iZWhhdmlvcnMuZGlzYWJsZSgnc2Nyb2xsWm9vbScpO1xyXG59O1xyXG4gXHJcbnltYXBzLnJlYWR5KGluaXQpO1xyXG5cclxuLy9PbmUgcGFnZSBzY3JvbGxcclxuY29uc3Qgc2VjdGlvbnMgPSAkKFwic2VjdGlvblwiKTtcclxuY29uc3QgZGlzcGxheSA9ICQoXCIubWFpbmNvbnRlbnRcIik7XHJcbmNvbnN0IHNpZGVNZW51ID0gJChcIi5maXhlZC1tZW51XCIpO1xyXG5jb25zdCBtZW51SXRlbXMgPSBzaWRlTWVudS5maW5kKFwiLmZpeGVkLW1lbnVfX2l0ZW1cIik7XHJcblxyXG5jb25zdCBtb2JpbGVEZXRlY3QgPSBuZXcgTW9iaWxlRGV0ZWN0KHdpbmRvdy5uYXZpZ2F0b3IudXNlckFnZW50KTtcclxuY29uc3QgaXNNb2JpbGUgPSBtb2JpbGVEZXRlY3QubW9iaWxlKCk7XHJcblxyXG5sZXQgaW5TY3JvbGwgPSBmYWxzZTtcclxuXHJcbnNlY3Rpb25zLmZpcnN0KCkuYWRkQ2xhc3MoXCJhY3RpdmVcIik7XHJcblxyXG5jb25zdCBjb3VudFNlY3Rpb25Qb3NpdGlvbiA9IChzZWN0aW9uRXEpID0+IHtcclxuICBjb25zdCBwb3NpdGlvbiA9IHNlY3Rpb25FcSAqIC0xMDA7XHJcblxyXG4gIGlmIChpc05hTihwb3NpdGlvbikpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoXCLQv9C10YDQtdC00LDQvdC+INC90LXQstC10YDQvdC+0LUg0LfQvdCw0YfQtdC90LjQtSDQsiBjb3VudFNlY3Rpb25Qb3NpdGlvblwiKTtcclxuICAgIHJldHVybiAwO1xyXG4gIH1cclxuICBcclxuICByZXR1cm4gcG9zaXRpb247XHJcbn07XHJcblxyXG5jb25zdCBjaGFuZ2VNZW51VGhlbWVGb3JTZWN0aW9uID0gc2VjdGlvbkVxID0+IHtcclxuICBjb25zdCBjdXJyZW50U2VjdGlvbiA9IHNlY3Rpb25zLmVxKHNlY3Rpb25FcSk7XHJcbiAgY29uc3QgbWVudVRoZW1lID0gY3VycmVudFNlY3Rpb24uYXR0cihcImRhdGEtc2lkZW1lbnUtdGhlbWVcIik7XHJcbiAgY29uc3QgYWN0aXZlQ2xhc3MgPSBcImZpeGVkLW1lbnUtLXNoYWRvd2VkXCI7XHJcblxyXG4gIGlmIChtZW51VGhlbWUgPT09IFwiYmxhY2tcIikge1xyXG4gICAgc2lkZU1lbnUuYWRkQ2xhc3MoYWN0aXZlQ2xhc3MpO1xyXG4gIH0gZWxzZSB7XHJcbiAgICBzaWRlTWVudS5yZW1vdmVDbGFzcyhcImZpeGVkLW1lbnUtLXNoYWRvd2VkXCIpO1xyXG4gIH1cclxufTtcclxuXHJcbmNvbnN0IHJlc2V0QWN0aXZlQ2xhc3NGb3JJdGVtID0gKGl0ZW1zLCBpdGVtRXEsIGFjdGl2ZUNsYXNzKSA9PiB7XHJcbiAgaXRlbXMuZXEoaXRlbUVxKS5hZGRDbGFzcyhhY3RpdmVDbGFzcykuc2libGluZ3MoKS5yZW1vdmVDbGFzcyhhY3RpdmVDbGFzcyk7XHJcbn1cclxuXHJcbmNvbnN0IHBlcmZvcm1UcmFuc2l0aW9uID0gKHNlY3Rpb25FcSkgPT4ge1xyXG4gIGlmIChpblNjcm9sbCkgcmV0dXJuO1xyXG5cclxuICBjb25zdCB0cmFuc2l0aW9uT3ZlciA9IDEwMDA7XHJcbiAgY29uc3QgbW91c2VJbmVydGlhT3ZlciA9IDMwMDtcclxuXHJcbiAgaW5TY3JvbGwgPSB0cnVlO1xyXG5cclxuICBjb25zdCBwb3NpdGlvbiA9IGNvdW50U2VjdGlvblBvc2l0aW9uKHNlY3Rpb25FcSk7XHJcblxyXG4gIGNoYW5nZU1lbnVUaGVtZUZvclNlY3Rpb24oc2VjdGlvbkVxKTtcclxuXHJcbiAgZGlzcGxheS5jc3Moe1xyXG4gICAgdHJhbnNmb3JtOiBgdHJhbnNsYXRlWSgke3Bvc2l0aW9ufSUpYFxyXG4gIH0pO1xyXG5cclxuICByZXNldEFjdGl2ZUNsYXNzRm9ySXRlbShzZWN0aW9ucywgc2VjdGlvbkVxLCBcImFjdGl2ZVwiKTtcclxuXHJcbiAgc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICBpblNjcm9sbCA9IGZhbHNlO1xyXG5cclxuICAgIHJlc2V0QWN0aXZlQ2xhc3NGb3JJdGVtKG1lbnVJdGVtcywgc2VjdGlvbkVxLCBcImZpeGVkLW1lbnVfX2l0ZW0tLWFjdGl2ZVwiKTtcclxuICB9LCB0cmFuc2l0aW9uT3ZlciArIG1vdXNlSW5lcnRpYU92ZXIpO1xyXG59O1xyXG5cclxuY29uc3Qgdmlld3BvcnRTY3JvbGxlciA9ICgpID0+IHtcclxuICBjb25zdCBhY3RpdmVTZWN0aW9uID0gc2VjdGlvbnMuZmlsdGVyKFwiLmFjdGl2ZVwiKTtcclxuICBjb25zdCBuZXh0U2VjdGlvbiA9IGFjdGl2ZVNlY3Rpb24ubmV4dCgpO1xyXG4gIGNvbnN0IHByZXZTZWN0aW9uID0gYWN0aXZlU2VjdGlvbi5wcmV2KCk7XHJcblxyXG4gIHJldHVybiB7XHJcbiAgICBuZXh0KCkge1xyXG4gICAgICBpZiAobmV4dFNlY3Rpb24ubGVuZ3RoKSB7XHJcbiAgICAgICAgcGVyZm9ybVRyYW5zaXRpb24obmV4dFNlY3Rpb24uaW5kZXgoKSlcclxuICAgICAgfVxyXG4gICAgfSxcclxuICAgIHByZXYoKSB7XHJcbiAgICAgIGlmIChwcmV2U2VjdGlvbi5sZW5ndGgpIHtcclxuICAgICAgICBwZXJmb3JtVHJhbnNpdGlvbihwcmV2U2VjdGlvbi5pbmRleCgpKVxyXG4gICAgICB9XHJcbiAgICB9LFxyXG4gIH07XHJcbn07XHJcblxyXG4kKHdpbmRvdykub24oXCJ3aGVlbFwiLCBlID0+IHtcclxuICBjb25zdCBkZWx0YVkgPSBlLm9yaWdpbmFsRXZlbnQuZGVsdGFZO1xyXG4gIGNvbnN0IHNjcm9sbGVyID0gdmlld3BvcnRTY3JvbGxlcigpO1xyXG5cclxuICBpZiAoZGVsdGFZID4gMCkge1xyXG4gICAgc2Nyb2xsZXIubmV4dCgpO1xyXG4gIH1cclxuXHJcbiAgaWYgKGRlbHRhWSA8IDApIHtcclxuICAgIHNjcm9sbGVyLnByZXYoKTtcclxuICB9XHJcbn0pO1xyXG5cclxuJCh3aW5kb3cpLm9uKFwia2V5ZG93blwiLCBlID0+IHtcclxuICBjb25zdCB0YWdOYW1lID0gZS50YXJnZXQudGFnTmFtZS50b0xvd2VyQ2FzZSgpO1xyXG4gIGNvbnN0IHVzZXJUeXBpbmdJbklucHV0cyA9IHRhZ05hbWUgPT09IFwiaW5wdXRcIiB8fCB0YWdOYW1lID09PSBcInRleHRhcmVhXCI7XHJcbiAgY29uc3Qgc2Nyb2xsZXIgPSB2aWV3cG9ydFNjcm9sbGVyKCk7XHJcblxyXG4gIGlmICh1c2VyVHlwaW5nSW5JbnB1dHMpIHJldHVybjtcclxuXHJcbiAgc3dpdGNoIChlLmtleUNvZGUpIHtcclxuICAgIGNhc2UgMzg6IC8vcHJldlxyXG4gICAgc2Nyb2xsZXIucHJldigpO1xyXG4gICAgICBicmVhaztcclxuICBcclxuICAgIGNhc2UgNDA6IC8vbmV4dFxyXG4gICAgICBzY3JvbGxlci5uZXh0KCk7XHJcbiAgICAgIGJyZWFrO1xyXG4gIH1cclxufSk7XHJcblxyXG4kKFwiLndyYXBwZXJcIikub24oXCJ0b3VjaG1vdmVcIiwgZSA9PiBlLnByZXZlbnREZWZhdWx0KCkpO1xyXG5cclxuJChcIltkYXRhLXNjcm9sbC10b11cIikuY2xpY2soZSA9PiB7XHJcbiAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG5cclxuICBjb25zdCAkdGhpcyA9ICQoZS5jdXJyZW50VGFyZ2V0KTtcclxuICBjb25zdCB0YXJnZXQgPSAkdGhpcy5hdHRyKFwiZGF0YS1zY3JvbGwtdG9cIik7XHJcbiAgY29uc3QgcmVxU2VjdGlvbiA9ICQoYFtkYXRhLXNlY3Rpb24taWQ9JHt0YXJnZXR9XWApO1xyXG5cclxuICBwZXJmb3JtVHJhbnNpdGlvbihyZXFTZWN0aW9uLmluZGV4KCkpO1xyXG59KVxyXG5cclxuaWYgKGlzTW9iaWxlKSB7XHJcbiAgJChcImJvZHlcIikuc3dpcGUoe1xyXG4gICAgc3dpcGU6IGZ1bmN0aW9uIChldmVudCwgZGlyZWN0aW9uKSB7XHJcbiAgICAgIGNvbnN0IHNjcm9sbGVyID0gdmlld3BvcnRTY3JvbGxlcigpO1xyXG4gICAgICBsZXQgc2Nyb2xsRGlyZWN0aW9uID0gXCJcIjtcclxuICBcclxuICAgICAgaWYgKGRpcmVjdGlvbiA9PT0gXCJ1cFwiKSBzY3JvbGxEaXJlY3Rpb24gPSBcIm5leHRcIjtcclxuICAgICAgaWYgKGRpcmVjdGlvbiA9PT0gXCJkb3duXCIpIHNjcm9sbERpcmVjdGlvbiA9IFwicHJldlwiO1xyXG5cclxuICAgICAgaWYgKHNjcm9sbERpcmVjdGlvbiA9PSBcIm5leHRcIiB8fCBzY3JvbGxEaXJlY3Rpb24gPT0gXCJwcmV2XCIpIHtcclxuICAgICAgICBzY3JvbGxlcltzY3JvbGxEaXJlY3Rpb25dKCk7ICBcclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH0pO1xyXG59Il19
