// поиск кнопки по идентификатору
var hamburgerButton = document.querySelector('#hamburger');

// поиск меню по идентификатору
var hamburgerMenu = document.querySelector('#hamburgerMenu');
let links = document.querySelectorAll('.menu__link');

// слушаем события на кнопке
// при клике снимаем и возвращаем активный класс на кнопку и меню

hamburgerButton.addEventListener('click', toggleMenu);

function toggleMenu(event) {
  event.preventDefault();
  hamburgerButton.classList.toggle('hamburger--active');
  hamburgerMenu.classList.toggle('menu--active');
};

links.forEach(function(element) {
  element.addEventListener('click', toggleMenu);
});

//Слайдер-карусель

const slider = $('.offers').bxSlider({
  pager: false,
  controls: false
});

$('.offers-slider__arrow--left').click(e => {
  e.preventDefault();

  slider.goToPrevSlide();
});

$('.offers-slider__arrow--right').click(e => {
  e.preventDefault();

  slider.goToNextSlide();
});

//Слайдшоу - переключение
const findBlockByAlias = (alias) => {
  return $(".reviews__item").filter((ndx, item) => {
    return $(item).attr("data-chain") === alias;
  });
};

$(".reviews-switcher__link").click((e) => {
  e.preventDefault();

  const $this = $(e.currentTarget);
  const target = $this.attr("data-open");
  const itemToShow = findBlockByAlias(target);
  const curItem = $this.closest(".reviews-switcher__item");

  itemToShow.addClass("active").siblings().removeClass("active");
  curItem.addClass("active").siblings().removeClass("active");
});

//Вертикальный аккордеон
const openItem = (item) => {
  const container = item.closest(".team__item");
  const contentBlock = container.find(".team__content");
  const textBlock = contentBlock.find(".team__content-block");
  const reqHeight = textBlock.height();

  container.addClass("active");
  contentBlock.height(reqHeight);
};

const closeEveryItem = (container) => {
  const items = container.find(".team__content");
  const itemContainer = container.find(".team__item");

  itemContainer.removeClass("active");
  items.height(0);
};

$('.team__title').click((e) => {
  const $this = $(e.currentTarget);
  const container = $this.closest('.team');
  const elemContainer = $this.closest(".team__item");
  
  if (elemContainer.hasClass("active")) {
    closeEveryItem(container);
  } else {
    closeEveryItem(container);
    openItem($this);
  }
}); 

//Форма
const validateFields = (form, fieldsArray) => {
  fieldsArray.forEach((field) => {
    field.removeClass("input-error");
    if (field.val().trim() === "") {
      field.addClass("input-error");
    }
  });

  const errorFields = form.find(".input-error");

  return errorFields.length === 0;
}

$(".form").submit(e => {
  e.preventDefault();

  const form = $(e.currentTarget);
  const name = form.find("[name='name']");
  const phone = form.find("[name='phone']");
  const comment = form.find("[name='comment']");
  const to = form.find("[name='to']");

  const modal = $("#modal");
  const content = modal.find(".modal__content");

  modal.removeClass("error-modal");

  const isValid = validateFields(form, [name, phone, comment, to]);

  if (isValid) {
    const request = $.ajax({
      url: "https://webdev-api.loftschool.com/sendmail",
      method: "post",
      data: {
        name: name.val(),
        phone: phone.val(),
        comment: comment.val(),
        to: to.val(),
      }
    });
    request.done((data) => {
      content.text(data.message);
    });
    request.fail((data) => {
      const message = data.responseJSON.message;
      content.text(message);
      modal.addClass("error-modal");
    });
    request.always(() => {
      $.fancybox.open({
        src: "#modal",
        type: "inline"
      });
    });
  }
});

$(".app-submit-btn").click(e => {
  e.preventDefault();

  $.fancybox.close();
});

//Горизонтальный аккордеон
const mesureWidth = (unit) => {
  let reqUnitWidth = 0;
  const screenWidth = $(window).width();
  const container = unit.closest(".products__list");
  const titlesBlocks = container.find(".product__title");
  const titlesWidth = titlesBlocks.width() * titlesBlocks.length;

  const textContainer = unit.find(".product__container");
  const paddingLeft = parseInt(textContainer.css("padding-left"));
  const paddingRight = parseInt(textContainer.css("padding-right"));

  const isTablet = window.matchMedia("(max-width: 768px)").matches;
  const isMobile = window.matchMedia("(max-width: 480px)").matches;
  
  if (isTablet) {
    reqUnitWidth = screenWidth - titlesWidth;
  } 
  if (isMobile) {
    reqUnitWidth = screenWidth - titlesBlocks.width();
  } 
  
  if (!isTablet && !isMobile) {
    reqUnitWidth = 524;
  }

  return {
    container: reqUnitWidth,
    textContainer: reqUnitWidth - paddingRight - paddingLeft
  }
};

//Смена заголовка в секции "Цвета" по клику на плашку
/*$('.product__title').click(function() {
  if (!$(this).data('status')) {
    $('.products__title').text('меню');
    $(this).data('status', true);
  } else {
    $('.products__title').text('цвета');
    $(this).data('status', false);
  }  
});*/

const closeEveryUnitInContainer = container => {
  const units = container.find(".products__item");
  const content = container.find(".product__content");

  units.removeClass("active");
  content.width(0);
};

const openUnit = (unit) => {
  const hiddenContent = unit.find(".product__content");
  const reqWidth = mesureWidth(unit);
  const textBlock = unit.find(".product__container");

  unit.addClass("active");
  hiddenContent.width(reqWidth.container);
  textBlock.width(reqWidth.textContainer);
};

$(".product__title").on("click", e => {
  e.preventDefault();

  const $this = $(e.currentTarget);
  const unit = $this.closest(".product");
  const unitOpened = unit.hasClass("active");
  const container = $this.closest(".products__list");

  if (unitOpened) {
    closeEveryUnitInContainer(container);
  } else {
    closeEveryUnitInContainer(container);
    openUnit(unit);
  }
});

//Видеоплеер
let video;
let durationControl;
let soundControl;
let intervalId;

// кнопки
const playBtn = document.querySelector(".video__player-img");
const soundBtn = document.querySelector(".sound");
const playerPlayBtn = document.querySelector(".duration__img");


video = document.getElementById("player");

// как только плеер загрузится
// video.addEventListener('loadeddata', function() {
    // вешаем обработчик события onclick на тег video
    video.addEventListener('click', playStop);

    // обработчики событий для кнопок play
    let playButtons = document.querySelectorAll(".play");
    for (let i = 0; i < playButtons.length; i++) {
        playButtons[i].addEventListener('click', playStop);
    }

    // обработчик событий для кнопки динамик
    let micControl = document.getElementById("mic");
    micControl.addEventListener('click', soundOf);

    // обработчики событий для ползунка продолжительности видео
    durationControl = document.getElementById("durationLevel");
    durationControl.addEventListener('input', setVideoDuration);

    durationControl.min = 0;
    durationControl.value = 0;
    // присваиваем ползунку продолжительности максимальное значение равное продолжительности нашего видео (в секундах)
    durationControl.max = video.duration;

    // обработчики событий для ползунка громокости
    soundControl = document.getElementById("micLevel");
    soundControl.addEventListener('input', changeSoundVolume);
    // soundControl.addEventListener('onmousemove', changeSoundVolume);

    // задаем максимальные и минимальные значения громокости
    soundControl.min = 0;
    soundControl.max = 10;
    // soundControl.step = 1;
    // присваиваем ползунку максимальное значение
    soundControl.value = soundControl.max;


    //обрабатываем окончание видео
    video.addEventListener('ended', function() {
        playBtn.classList.toggle("video__player-img--active");
        video.currentTime = 0;
        playerPlayBtn.classList.remove('active');
    });
// });



/*
 Воспроизведение видео
*/
function playStop() {
    // показывает или скрывает белую кнопку play
    playBtn.classList.toggle("video__player-img--active");

    // проверим стоит ли видео на паузе, если да то продолжим воспроизведение.

    if (video.paused) {
        // запускаем видео
        video.play();
        // Включаем функцию обновления прогресса
        intervalId = setInterval(updateDuration, 1000 / 60);
        // превращаем маленькую кнопку play в pause
        playerPlayBtn.classList.add('active');
        // Если, наоборот, проигрыавыется, то остановим.
    } else {
        // останавливаем видео
        video.pause();
        // останавливаем обновление прогресса
        clearInterval(intervalId);
        // превращаем маленькую кнопку pause в play
        playerPlayBtn.classList.remove('active');
    }
}

/*
    Реализует возможность перемотки нашего видео
*/
function setVideoDuration() {
    // установить значение ползунка в текущее время
    video.currentTime = durationControl.value;
    updateDuration();
    // intervalId = setInterval(updateDuration, 1000 / 60);
}


/*
  Функция для обновления позиции ползунка продолжительности видео.   
*/
function updateDuration() {
    // устанавливаем в наш инпут текущее время
    durationControl.value = video.currentTime;
    // рассчитываем процент для закраски прогресса
    let step = video.duration / 100;
    let percent = video.currentTime / step;
    // устанавливаем стили
    durationControl.style.background = `linear-gradient(90deg, #E01F3D 0%, #E01F3D ${percent}%, #626262 ${percent}%)`;

}


/*
    Управление звуком
*/
function soundOf() {
    /*
        Делаем проверку уровня громкости. 
        Если у нас нашего видео есть звук, то мы его выключаем. 
        Предварительно запомнив текущую позицию громкости в переменную soundLevel
    */
    if (video.volume === 0) {
        video.volume = soundLevel;
        soundControl.value = soundLevel * 10;
        soundBtn.classList.remove('active');
    } else {
        /*
            Если у нашего видео нет звука, то выставляем уровень громкости на прежний уровень.
            Хранится в перменной soundLevel
        */
        soundLevel = video.volume;
        video.volume = 0;
        soundControl.value = 0;
        soundBtn.classList.add('active');

    }
}

/*
    Управление звуком видео
*/
function changeSoundVolume() {
    /*
        Св-во volume может принимать значения от 0 до 1
        Делим на 10 для того что бы, была возможность более точной регулировки видео. 
   video.volume 0 .... 1 
   soundControl 0 .... 10
        */

    video.volume = soundControl.value / 10;
    if (video.volume == 0) {
        soundBtn.classList.add('active');
    } else {
        soundBtn.classList.remove('active');
    }
    console.log('значение volume у видео ' + video.volume);
    console.log('значение value у micLevel ' + soundControl.value / 10);
    /**У ползунка изначально задано минимальное значение 0 и максимальное 10 чтоб дать нам 10 положений
     * регулировки
     */
}

//Карта
let myMap;
const init = () => {
 myMap = new ymaps.Map("map", {
   center: [55.752132, 37.622807],
   zoom: 13,
   controls: [],
 });
 
 let coords = [
     [55.759211, 37.582637],
     [55.749662, 37.603889],
     [55.743069, 37.580987],
     [55.756917, 37.620619],
   ],
   myCollection = new ymaps.GeoObjectCollection({}, {
     draggable: false,
     iconLayout: 'default#image',
     iconImageHref: './img/icons/marker.svg',
     iconImageSize: [58, 73],
     iconImageOffset: [-35, -52]
   });
 
 for (let i = 0; i < coords.length; i++) {
   myCollection.add(new ymaps.Placemark(coords[i]));
 }
 
 myMap.geoObjects.add(myCollection);
 
 myMap.behaviors.disable('scrollZoom');
};
 
ymaps.ready(init);

//One page scroll
const sections = $("section");
const display = $(".maincontent");
const sideMenu = $(".fixed-menu");
const menuItems = sideMenu.find(".fixed-menu__item");

const mobileDetect = new MobileDetect(window.navigator.userAgent);
const isMobile = mobileDetect.mobile();

let inScroll = false;

sections.first().addClass("active");

const countSectionPosition = (sectionEq) => {
  const position = sectionEq * -100;

  if (isNaN(position)) {
    console.error("передано неверное значение в countSectionPosition");
    return 0;
  }
  
  return position;
};

const changeMenuThemeForSection = sectionEq => {
  const currentSection = sections.eq(sectionEq);
  const menuTheme = currentSection.attr("data-sidemenu-theme");
  const activeClass = "fixed-menu--shadowed";

  if (menuTheme === "white") {
    sideMenu.addClass(activeClass);
  } else {
    sideMenu.removeClass("fixed-menu--shadowed");
  }
};

const resetActiveClassForItem = (items, itemEq, activeClass) => {
  items.eq(itemEq).addClass(activeClass).siblings().removeClass(activeClass);
}

const performTransition = (sectionEq) => {
  if (inScroll) return;

  const transitionOver = 1000;
  const mouseInertiaOver = 300;

  inScroll = true;

  const position = countSectionPosition(sectionEq);

  changeMenuThemeForSection(sectionEq);

  display.css({
    transform: `translateY(${position}%)`
  });

  resetActiveClassForItem(sections, sectionEq, "active");

  setTimeout(() => {
    inScroll = false;

    resetActiveClassForItem(menuItems, sectionEq, "fixed-menu__item--active");
  }, transitionOver + mouseInertiaOver);
};

const viewportScroller = () => {
  const activeSection = sections.filter(".active");
  const nextSection = activeSection.next();
  const prevSection = activeSection.prev();

  return {
    next() {
      if (nextSection.length) {
        performTransition(nextSection.index())
      }
    },
    prev() {
      if (prevSection.length) {
        performTransition(prevSection.index())
      }
    },
  };
};

$(window).on("wheel", e => {
  const deltaY = e.originalEvent.deltaY;
  const scroller = viewportScroller();

  if (deltaY > 0) {
    scroller.next();
  }

  if (deltaY < 0) {
    scroller.prev();
  }
});

$(window).on("keydown", e => {
  const tagName = e.target.tagName.toLowerCase();
  const userTypingInInputs = tagName === "input" || tagName === "textarea";
  const scroller = viewportScroller();

  if (userTypingInInputs) return;

  switch (e.keyCode) {
    case 38: //prev
    scroller.prev();
      break;
  
    case 40: //next
      scroller.next();
      break;
  }
});

$(".wrapper").on("touchmove", e => e.preventDefault());

$("[data-scroll-to]").click(e => {
  e.preventDefault();

  const $this = $(e.currentTarget);
  const target = $this.attr("data-scroll-to");
  const reqSection = $(`[data-section-id=${target}]`);

  performTransition(reqSection.index());
})

if (isMobile) {
  $("body").swipe({
    swipe: function (event, direction) {
      const scroller = viewportScroller();
      let scrollDirection = "";
  
      if (direction === "up") scrollDirection = "next";
      if (direction === "down") scrollDirection = "prev";

      if (scrollDirection == "next" || scrollDirection == "prev") {
        scroller[scrollDirection]();  
      }
    }
  });
}
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImJlYXRzLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsImZpbGUiOiJtYWluLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8vINC/0L7QuNGB0Log0LrQvdC+0L/QutC4INC/0L4g0LjQtNC10L3RgtC40YTQuNC60LDRgtC+0YDRg1xyXG52YXIgaGFtYnVyZ2VyQnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI2hhbWJ1cmdlcicpO1xyXG5cclxuLy8g0L/QvtC40YHQuiDQvNC10L3RjiDQv9C+INC40LTQtdC90YLQuNGE0LjQutCw0YLQvtGA0YNcclxudmFyIGhhbWJ1cmdlck1lbnUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjaGFtYnVyZ2VyTWVudScpO1xyXG5sZXQgbGlua3MgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcubWVudV9fbGluaycpO1xyXG5cclxuLy8g0YHQu9GD0YjQsNC10Lwg0YHQvtCx0YvRgtC40Y8g0L3QsCDQutC90L7Qv9C60LVcclxuLy8g0L/RgNC4INC60LvQuNC60LUg0YHQvdC40LzQsNC10Lwg0Lgg0LLQvtC30LLRgNCw0YnQsNC10Lwg0LDQutGC0LjQstC90YvQuSDQutC70LDRgdGBINC90LAg0LrQvdC+0L/QutGDINC4INC80LXQvdGOXHJcblxyXG5oYW1idXJnZXJCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCB0b2dnbGVNZW51KTtcclxuXHJcbmZ1bmN0aW9uIHRvZ2dsZU1lbnUoZXZlbnQpIHtcclxuICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gIGhhbWJ1cmdlckJ1dHRvbi5jbGFzc0xpc3QudG9nZ2xlKCdoYW1idXJnZXItLWFjdGl2ZScpO1xyXG4gIGhhbWJ1cmdlck1lbnUuY2xhc3NMaXN0LnRvZ2dsZSgnbWVudS0tYWN0aXZlJyk7XHJcbn07XHJcblxyXG5saW5rcy5mb3JFYWNoKGZ1bmN0aW9uKGVsZW1lbnQpIHtcclxuICBlbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgdG9nZ2xlTWVudSk7XHJcbn0pO1xyXG5cclxuLy/QodC70LDQudC00LXRgC3QutCw0YDRg9GB0LXQu9GMXHJcblxyXG5jb25zdCBzbGlkZXIgPSAkKCcub2ZmZXJzJykuYnhTbGlkZXIoe1xyXG4gIHBhZ2VyOiBmYWxzZSxcclxuICBjb250cm9sczogZmFsc2VcclxufSk7XHJcblxyXG4kKCcub2ZmZXJzLXNsaWRlcl9fYXJyb3ctLWxlZnQnKS5jbGljayhlID0+IHtcclxuICBlLnByZXZlbnREZWZhdWx0KCk7XHJcblxyXG4gIHNsaWRlci5nb1RvUHJldlNsaWRlKCk7XHJcbn0pO1xyXG5cclxuJCgnLm9mZmVycy1zbGlkZXJfX2Fycm93LS1yaWdodCcpLmNsaWNrKGUgPT4ge1xyXG4gIGUucHJldmVudERlZmF1bHQoKTtcclxuXHJcbiAgc2xpZGVyLmdvVG9OZXh0U2xpZGUoKTtcclxufSk7XHJcblxyXG4vL9Ch0LvQsNC50LTRiNC+0YMgLSDQv9C10YDQtdC60LvRjtGH0LXQvdC40LVcclxuY29uc3QgZmluZEJsb2NrQnlBbGlhcyA9IChhbGlhcykgPT4ge1xyXG4gIHJldHVybiAkKFwiLnJldmlld3NfX2l0ZW1cIikuZmlsdGVyKChuZHgsIGl0ZW0pID0+IHtcclxuICAgIHJldHVybiAkKGl0ZW0pLmF0dHIoXCJkYXRhLWNoYWluXCIpID09PSBhbGlhcztcclxuICB9KTtcclxufTtcclxuXHJcbiQoXCIucmV2aWV3cy1zd2l0Y2hlcl9fbGlua1wiKS5jbGljaygoZSkgPT4ge1xyXG4gIGUucHJldmVudERlZmF1bHQoKTtcclxuXHJcbiAgY29uc3QgJHRoaXMgPSAkKGUuY3VycmVudFRhcmdldCk7XHJcbiAgY29uc3QgdGFyZ2V0ID0gJHRoaXMuYXR0cihcImRhdGEtb3BlblwiKTtcclxuICBjb25zdCBpdGVtVG9TaG93ID0gZmluZEJsb2NrQnlBbGlhcyh0YXJnZXQpO1xyXG4gIGNvbnN0IGN1ckl0ZW0gPSAkdGhpcy5jbG9zZXN0KFwiLnJldmlld3Mtc3dpdGNoZXJfX2l0ZW1cIik7XHJcblxyXG4gIGl0ZW1Ub1Nob3cuYWRkQ2xhc3MoXCJhY3RpdmVcIikuc2libGluZ3MoKS5yZW1vdmVDbGFzcyhcImFjdGl2ZVwiKTtcclxuICBjdXJJdGVtLmFkZENsYXNzKFwiYWN0aXZlXCIpLnNpYmxpbmdzKCkucmVtb3ZlQ2xhc3MoXCJhY3RpdmVcIik7XHJcbn0pO1xyXG5cclxuLy/QktC10YDRgtC40LrQsNC70YzQvdGL0Lkg0LDQutC60L7RgNC00LXQvtC9XHJcbmNvbnN0IG9wZW5JdGVtID0gKGl0ZW0pID0+IHtcclxuICBjb25zdCBjb250YWluZXIgPSBpdGVtLmNsb3Nlc3QoXCIudGVhbV9faXRlbVwiKTtcclxuICBjb25zdCBjb250ZW50QmxvY2sgPSBjb250YWluZXIuZmluZChcIi50ZWFtX19jb250ZW50XCIpO1xyXG4gIGNvbnN0IHRleHRCbG9jayA9IGNvbnRlbnRCbG9jay5maW5kKFwiLnRlYW1fX2NvbnRlbnQtYmxvY2tcIik7XHJcbiAgY29uc3QgcmVxSGVpZ2h0ID0gdGV4dEJsb2NrLmhlaWdodCgpO1xyXG5cclxuICBjb250YWluZXIuYWRkQ2xhc3MoXCJhY3RpdmVcIik7XHJcbiAgY29udGVudEJsb2NrLmhlaWdodChyZXFIZWlnaHQpO1xyXG59O1xyXG5cclxuY29uc3QgY2xvc2VFdmVyeUl0ZW0gPSAoY29udGFpbmVyKSA9PiB7XHJcbiAgY29uc3QgaXRlbXMgPSBjb250YWluZXIuZmluZChcIi50ZWFtX19jb250ZW50XCIpO1xyXG4gIGNvbnN0IGl0ZW1Db250YWluZXIgPSBjb250YWluZXIuZmluZChcIi50ZWFtX19pdGVtXCIpO1xyXG5cclxuICBpdGVtQ29udGFpbmVyLnJlbW92ZUNsYXNzKFwiYWN0aXZlXCIpO1xyXG4gIGl0ZW1zLmhlaWdodCgwKTtcclxufTtcclxuXHJcbiQoJy50ZWFtX190aXRsZScpLmNsaWNrKChlKSA9PiB7XHJcbiAgY29uc3QgJHRoaXMgPSAkKGUuY3VycmVudFRhcmdldCk7XHJcbiAgY29uc3QgY29udGFpbmVyID0gJHRoaXMuY2xvc2VzdCgnLnRlYW0nKTtcclxuICBjb25zdCBlbGVtQ29udGFpbmVyID0gJHRoaXMuY2xvc2VzdChcIi50ZWFtX19pdGVtXCIpO1xyXG4gIFxyXG4gIGlmIChlbGVtQ29udGFpbmVyLmhhc0NsYXNzKFwiYWN0aXZlXCIpKSB7XHJcbiAgICBjbG9zZUV2ZXJ5SXRlbShjb250YWluZXIpO1xyXG4gIH0gZWxzZSB7XHJcbiAgICBjbG9zZUV2ZXJ5SXRlbShjb250YWluZXIpO1xyXG4gICAgb3Blbkl0ZW0oJHRoaXMpO1xyXG4gIH1cclxufSk7IFxyXG5cclxuLy/QpNC+0YDQvNCwXHJcbmNvbnN0IHZhbGlkYXRlRmllbGRzID0gKGZvcm0sIGZpZWxkc0FycmF5KSA9PiB7XHJcbiAgZmllbGRzQXJyYXkuZm9yRWFjaCgoZmllbGQpID0+IHtcclxuICAgIGZpZWxkLnJlbW92ZUNsYXNzKFwiaW5wdXQtZXJyb3JcIik7XHJcbiAgICBpZiAoZmllbGQudmFsKCkudHJpbSgpID09PSBcIlwiKSB7XHJcbiAgICAgIGZpZWxkLmFkZENsYXNzKFwiaW5wdXQtZXJyb3JcIik7XHJcbiAgICB9XHJcbiAgfSk7XHJcblxyXG4gIGNvbnN0IGVycm9yRmllbGRzID0gZm9ybS5maW5kKFwiLmlucHV0LWVycm9yXCIpO1xyXG5cclxuICByZXR1cm4gZXJyb3JGaWVsZHMubGVuZ3RoID09PSAwO1xyXG59XHJcblxyXG4kKFwiLmZvcm1cIikuc3VibWl0KGUgPT4ge1xyXG4gIGUucHJldmVudERlZmF1bHQoKTtcclxuXHJcbiAgY29uc3QgZm9ybSA9ICQoZS5jdXJyZW50VGFyZ2V0KTtcclxuICBjb25zdCBuYW1lID0gZm9ybS5maW5kKFwiW25hbWU9J25hbWUnXVwiKTtcclxuICBjb25zdCBwaG9uZSA9IGZvcm0uZmluZChcIltuYW1lPSdwaG9uZSddXCIpO1xyXG4gIGNvbnN0IGNvbW1lbnQgPSBmb3JtLmZpbmQoXCJbbmFtZT0nY29tbWVudCddXCIpO1xyXG4gIGNvbnN0IHRvID0gZm9ybS5maW5kKFwiW25hbWU9J3RvJ11cIik7XHJcblxyXG4gIGNvbnN0IG1vZGFsID0gJChcIiNtb2RhbFwiKTtcclxuICBjb25zdCBjb250ZW50ID0gbW9kYWwuZmluZChcIi5tb2RhbF9fY29udGVudFwiKTtcclxuXHJcbiAgbW9kYWwucmVtb3ZlQ2xhc3MoXCJlcnJvci1tb2RhbFwiKTtcclxuXHJcbiAgY29uc3QgaXNWYWxpZCA9IHZhbGlkYXRlRmllbGRzKGZvcm0sIFtuYW1lLCBwaG9uZSwgY29tbWVudCwgdG9dKTtcclxuXHJcbiAgaWYgKGlzVmFsaWQpIHtcclxuICAgIGNvbnN0IHJlcXVlc3QgPSAkLmFqYXgoe1xyXG4gICAgICB1cmw6IFwiaHR0cHM6Ly93ZWJkZXYtYXBpLmxvZnRzY2hvb2wuY29tL3NlbmRtYWlsXCIsXHJcbiAgICAgIG1ldGhvZDogXCJwb3N0XCIsXHJcbiAgICAgIGRhdGE6IHtcclxuICAgICAgICBuYW1lOiBuYW1lLnZhbCgpLFxyXG4gICAgICAgIHBob25lOiBwaG9uZS52YWwoKSxcclxuICAgICAgICBjb21tZW50OiBjb21tZW50LnZhbCgpLFxyXG4gICAgICAgIHRvOiB0by52YWwoKSxcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgICByZXF1ZXN0LmRvbmUoKGRhdGEpID0+IHtcclxuICAgICAgY29udGVudC50ZXh0KGRhdGEubWVzc2FnZSk7XHJcbiAgICB9KTtcclxuICAgIHJlcXVlc3QuZmFpbCgoZGF0YSkgPT4ge1xyXG4gICAgICBjb25zdCBtZXNzYWdlID0gZGF0YS5yZXNwb25zZUpTT04ubWVzc2FnZTtcclxuICAgICAgY29udGVudC50ZXh0KG1lc3NhZ2UpO1xyXG4gICAgICBtb2RhbC5hZGRDbGFzcyhcImVycm9yLW1vZGFsXCIpO1xyXG4gICAgfSk7XHJcbiAgICByZXF1ZXN0LmFsd2F5cygoKSA9PiB7XHJcbiAgICAgICQuZmFuY3lib3gub3Blbih7XHJcbiAgICAgICAgc3JjOiBcIiNtb2RhbFwiLFxyXG4gICAgICAgIHR5cGU6IFwiaW5saW5lXCJcclxuICAgICAgfSk7XHJcbiAgICB9KTtcclxuICB9XHJcbn0pO1xyXG5cclxuJChcIi5hcHAtc3VibWl0LWJ0blwiKS5jbGljayhlID0+IHtcclxuICBlLnByZXZlbnREZWZhdWx0KCk7XHJcblxyXG4gICQuZmFuY3lib3guY2xvc2UoKTtcclxufSk7XHJcblxyXG4vL9CT0L7RgNC40LfQvtC90YLQsNC70YzQvdGL0Lkg0LDQutC60L7RgNC00LXQvtC9XHJcbmNvbnN0IG1lc3VyZVdpZHRoID0gKHVuaXQpID0+IHtcclxuICBsZXQgcmVxVW5pdFdpZHRoID0gMDtcclxuICBjb25zdCBzY3JlZW5XaWR0aCA9ICQod2luZG93KS53aWR0aCgpO1xyXG4gIGNvbnN0IGNvbnRhaW5lciA9IHVuaXQuY2xvc2VzdChcIi5wcm9kdWN0c19fbGlzdFwiKTtcclxuICBjb25zdCB0aXRsZXNCbG9ja3MgPSBjb250YWluZXIuZmluZChcIi5wcm9kdWN0X190aXRsZVwiKTtcclxuICBjb25zdCB0aXRsZXNXaWR0aCA9IHRpdGxlc0Jsb2Nrcy53aWR0aCgpICogdGl0bGVzQmxvY2tzLmxlbmd0aDtcclxuXHJcbiAgY29uc3QgdGV4dENvbnRhaW5lciA9IHVuaXQuZmluZChcIi5wcm9kdWN0X19jb250YWluZXJcIik7XHJcbiAgY29uc3QgcGFkZGluZ0xlZnQgPSBwYXJzZUludCh0ZXh0Q29udGFpbmVyLmNzcyhcInBhZGRpbmctbGVmdFwiKSk7XHJcbiAgY29uc3QgcGFkZGluZ1JpZ2h0ID0gcGFyc2VJbnQodGV4dENvbnRhaW5lci5jc3MoXCJwYWRkaW5nLXJpZ2h0XCIpKTtcclxuXHJcbiAgY29uc3QgaXNUYWJsZXQgPSB3aW5kb3cubWF0Y2hNZWRpYShcIihtYXgtd2lkdGg6IDc2OHB4KVwiKS5tYXRjaGVzO1xyXG4gIGNvbnN0IGlzTW9iaWxlID0gd2luZG93Lm1hdGNoTWVkaWEoXCIobWF4LXdpZHRoOiA0ODBweClcIikubWF0Y2hlcztcclxuICBcclxuICBpZiAoaXNUYWJsZXQpIHtcclxuICAgIHJlcVVuaXRXaWR0aCA9IHNjcmVlbldpZHRoIC0gdGl0bGVzV2lkdGg7XHJcbiAgfSBcclxuICBpZiAoaXNNb2JpbGUpIHtcclxuICAgIHJlcVVuaXRXaWR0aCA9IHNjcmVlbldpZHRoIC0gdGl0bGVzQmxvY2tzLndpZHRoKCk7XHJcbiAgfSBcclxuICBcclxuICBpZiAoIWlzVGFibGV0ICYmICFpc01vYmlsZSkge1xyXG4gICAgcmVxVW5pdFdpZHRoID0gNTI0O1xyXG4gIH1cclxuXHJcbiAgcmV0dXJuIHtcclxuICAgIGNvbnRhaW5lcjogcmVxVW5pdFdpZHRoLFxyXG4gICAgdGV4dENvbnRhaW5lcjogcmVxVW5pdFdpZHRoIC0gcGFkZGluZ1JpZ2h0IC0gcGFkZGluZ0xlZnRcclxuICB9XHJcbn07XHJcblxyXG4vL9Ch0LzQtdC90LAg0LfQsNCz0L7Qu9C+0LLQutCwINCyINGB0LXQutGG0LjQuCBcItCm0LLQtdGC0LBcIiDQv9C+INC60LvQuNC60YMg0L3QsCDQv9C70LDRiNC60YNcclxuLyokKCcucHJvZHVjdF9fdGl0bGUnKS5jbGljayhmdW5jdGlvbigpIHtcclxuICBpZiAoISQodGhpcykuZGF0YSgnc3RhdHVzJykpIHtcclxuICAgICQoJy5wcm9kdWN0c19fdGl0bGUnKS50ZXh0KCfQvNC10L3RjicpO1xyXG4gICAgJCh0aGlzKS5kYXRhKCdzdGF0dXMnLCB0cnVlKTtcclxuICB9IGVsc2Uge1xyXG4gICAgJCgnLnByb2R1Y3RzX190aXRsZScpLnRleHQoJ9GG0LLQtdGC0LAnKTtcclxuICAgICQodGhpcykuZGF0YSgnc3RhdHVzJywgZmFsc2UpO1xyXG4gIH0gIFxyXG59KTsqL1xyXG5cclxuY29uc3QgY2xvc2VFdmVyeVVuaXRJbkNvbnRhaW5lciA9IGNvbnRhaW5lciA9PiB7XHJcbiAgY29uc3QgdW5pdHMgPSBjb250YWluZXIuZmluZChcIi5wcm9kdWN0c19faXRlbVwiKTtcclxuICBjb25zdCBjb250ZW50ID0gY29udGFpbmVyLmZpbmQoXCIucHJvZHVjdF9fY29udGVudFwiKTtcclxuXHJcbiAgdW5pdHMucmVtb3ZlQ2xhc3MoXCJhY3RpdmVcIik7XHJcbiAgY29udGVudC53aWR0aCgwKTtcclxufTtcclxuXHJcbmNvbnN0IG9wZW5Vbml0ID0gKHVuaXQpID0+IHtcclxuICBjb25zdCBoaWRkZW5Db250ZW50ID0gdW5pdC5maW5kKFwiLnByb2R1Y3RfX2NvbnRlbnRcIik7XHJcbiAgY29uc3QgcmVxV2lkdGggPSBtZXN1cmVXaWR0aCh1bml0KTtcclxuICBjb25zdCB0ZXh0QmxvY2sgPSB1bml0LmZpbmQoXCIucHJvZHVjdF9fY29udGFpbmVyXCIpO1xyXG5cclxuICB1bml0LmFkZENsYXNzKFwiYWN0aXZlXCIpO1xyXG4gIGhpZGRlbkNvbnRlbnQud2lkdGgocmVxV2lkdGguY29udGFpbmVyKTtcclxuICB0ZXh0QmxvY2sud2lkdGgocmVxV2lkdGgudGV4dENvbnRhaW5lcik7XHJcbn07XHJcblxyXG4kKFwiLnByb2R1Y3RfX3RpdGxlXCIpLm9uKFwiY2xpY2tcIiwgZSA9PiB7XHJcbiAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG5cclxuICBjb25zdCAkdGhpcyA9ICQoZS5jdXJyZW50VGFyZ2V0KTtcclxuICBjb25zdCB1bml0ID0gJHRoaXMuY2xvc2VzdChcIi5wcm9kdWN0XCIpO1xyXG4gIGNvbnN0IHVuaXRPcGVuZWQgPSB1bml0Lmhhc0NsYXNzKFwiYWN0aXZlXCIpO1xyXG4gIGNvbnN0IGNvbnRhaW5lciA9ICR0aGlzLmNsb3Nlc3QoXCIucHJvZHVjdHNfX2xpc3RcIik7XHJcblxyXG4gIGlmICh1bml0T3BlbmVkKSB7XHJcbiAgICBjbG9zZUV2ZXJ5VW5pdEluQ29udGFpbmVyKGNvbnRhaW5lcik7XHJcbiAgfSBlbHNlIHtcclxuICAgIGNsb3NlRXZlcnlVbml0SW5Db250YWluZXIoY29udGFpbmVyKTtcclxuICAgIG9wZW5Vbml0KHVuaXQpO1xyXG4gIH1cclxufSk7XHJcblxyXG4vL9CS0LjQtNC10L7Qv9C70LXQtdGAXHJcbmxldCB2aWRlbztcclxubGV0IGR1cmF0aW9uQ29udHJvbDtcclxubGV0IHNvdW5kQ29udHJvbDtcclxubGV0IGludGVydmFsSWQ7XHJcblxyXG4vLyDQutC90L7Qv9C60LhcclxuY29uc3QgcGxheUJ0biA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIudmlkZW9fX3BsYXllci1pbWdcIik7XHJcbmNvbnN0IHNvdW5kQnRuID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5zb3VuZFwiKTtcclxuY29uc3QgcGxheWVyUGxheUJ0biA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuZHVyYXRpb25fX2ltZ1wiKTtcclxuXHJcblxyXG52aWRlbyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwicGxheWVyXCIpO1xyXG5cclxuLy8g0LrQsNC6INGC0L7Qu9GM0LrQviDQv9C70LXQtdGAINC30LDQs9GA0YPQt9C40YLRgdGPXHJcbi8vIHZpZGVvLmFkZEV2ZW50TGlzdGVuZXIoJ2xvYWRlZGRhdGEnLCBmdW5jdGlvbigpIHtcclxuICAgIC8vINCy0LXRiNCw0LXQvCDQvtCx0YDQsNCx0L7RgtGH0LjQuiDRgdC+0LHRi9GC0LjRjyBvbmNsaWNrINC90LAg0YLQtdCzIHZpZGVvXHJcbiAgICB2aWRlby5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIHBsYXlTdG9wKTtcclxuXHJcbiAgICAvLyDQvtCx0YDQsNCx0L7RgtGH0LjQutC4INGB0L7QsdGL0YLQuNC5INC00LvRjyDQutC90L7Qv9C+0LogcGxheVxyXG4gICAgbGV0IHBsYXlCdXR0b25zID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChcIi5wbGF5XCIpO1xyXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBwbGF5QnV0dG9ucy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgIHBsYXlCdXR0b25zW2ldLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgcGxheVN0b3ApO1xyXG4gICAgfVxyXG5cclxuICAgIC8vINC+0LHRgNCw0LHQvtGC0YfQuNC6INGB0L7QsdGL0YLQuNC5INC00LvRjyDQutC90L7Qv9C60Lgg0LTQuNC90LDQvNC40LpcclxuICAgIGxldCBtaWNDb250cm9sID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJtaWNcIik7XHJcbiAgICBtaWNDb250cm9sLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgc291bmRPZik7XHJcblxyXG4gICAgLy8g0L7QsdGA0LDQsdC+0YLRh9C40LrQuCDRgdC+0LHRi9GC0LjQuSDQtNC70Y8g0L/QvtC70LfRg9C90LrQsCDQv9GA0L7QtNC+0LvQttC40YLQtdC70YzQvdC+0YHRgtC4INCy0LjQtNC10L5cclxuICAgIGR1cmF0aW9uQ29udHJvbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiZHVyYXRpb25MZXZlbFwiKTtcclxuICAgIGR1cmF0aW9uQ29udHJvbC5hZGRFdmVudExpc3RlbmVyKCdpbnB1dCcsIHNldFZpZGVvRHVyYXRpb24pO1xyXG5cclxuICAgIGR1cmF0aW9uQ29udHJvbC5taW4gPSAwO1xyXG4gICAgZHVyYXRpb25Db250cm9sLnZhbHVlID0gMDtcclxuICAgIC8vINC/0YDQuNGB0LLQsNC40LLQsNC10Lwg0L/QvtC70LfRg9C90LrRgyDQv9GA0L7QtNC+0LvQttC40YLQtdC70YzQvdC+0YHRgtC4INC80LDQutGB0LjQvNCw0LvRjNC90L7QtSDQt9C90LDRh9C10L3QuNC1INGA0LDQstC90L7QtSDQv9GA0L7QtNC+0LvQttC40YLQtdC70YzQvdC+0YHRgtC4INC90LDRiNC10LPQviDQstC40LTQtdC+ICjQsiDRgdC10LrRg9C90LTQsNGFKVxyXG4gICAgZHVyYXRpb25Db250cm9sLm1heCA9IHZpZGVvLmR1cmF0aW9uO1xyXG5cclxuICAgIC8vINC+0LHRgNCw0LHQvtGC0YfQuNC60Lgg0YHQvtCx0YvRgtC40Lkg0LTQu9GPINC/0L7Qu9C30YPQvdC60LAg0LPRgNC+0LzQvtC60L7RgdGC0LhcclxuICAgIHNvdW5kQ29udHJvbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwibWljTGV2ZWxcIik7XHJcbiAgICBzb3VuZENvbnRyb2wuYWRkRXZlbnRMaXN0ZW5lcignaW5wdXQnLCBjaGFuZ2VTb3VuZFZvbHVtZSk7XHJcbiAgICAvLyBzb3VuZENvbnRyb2wuYWRkRXZlbnRMaXN0ZW5lcignb25tb3VzZW1vdmUnLCBjaGFuZ2VTb3VuZFZvbHVtZSk7XHJcblxyXG4gICAgLy8g0LfQsNC00LDQtdC8INC80LDQutGB0LjQvNCw0LvRjNC90YvQtSDQuCDQvNC40L3QuNC80LDQu9GM0L3Ri9C1INC30L3QsNGH0LXQvdC40Y8g0LPRgNC+0LzQvtC60L7RgdGC0LhcclxuICAgIHNvdW5kQ29udHJvbC5taW4gPSAwO1xyXG4gICAgc291bmRDb250cm9sLm1heCA9IDEwO1xyXG4gICAgLy8gc291bmRDb250cm9sLnN0ZXAgPSAxO1xyXG4gICAgLy8g0L/RgNC40YHQstCw0LjQstCw0LXQvCDQv9C+0LvQt9GD0L3QutGDINC80LDQutGB0LjQvNCw0LvRjNC90L7QtSDQt9C90LDRh9C10L3QuNC1XHJcbiAgICBzb3VuZENvbnRyb2wudmFsdWUgPSBzb3VuZENvbnRyb2wubWF4O1xyXG5cclxuXHJcbiAgICAvL9C+0LHRgNCw0LHQsNGC0YvQstCw0LXQvCDQvtC60L7QvdGH0LDQvdC40LUg0LLQuNC00LXQvlxyXG4gICAgdmlkZW8uYWRkRXZlbnRMaXN0ZW5lcignZW5kZWQnLCBmdW5jdGlvbigpIHtcclxuICAgICAgICBwbGF5QnRuLmNsYXNzTGlzdC50b2dnbGUoXCJ2aWRlb19fcGxheWVyLWltZy0tYWN0aXZlXCIpO1xyXG4gICAgICAgIHZpZGVvLmN1cnJlbnRUaW1lID0gMDtcclxuICAgICAgICBwbGF5ZXJQbGF5QnRuLmNsYXNzTGlzdC5yZW1vdmUoJ2FjdGl2ZScpO1xyXG4gICAgfSk7XHJcbi8vIH0pO1xyXG5cclxuXHJcblxyXG4vKlxyXG4g0JLQvtGB0L/RgNC+0LjQt9Cy0LXQtNC10L3QuNC1INCy0LjQtNC10L5cclxuKi9cclxuZnVuY3Rpb24gcGxheVN0b3AoKSB7XHJcbiAgICAvLyDQv9C+0LrQsNC30YvQstCw0LXRgiDQuNC70Lgg0YHQutGA0YvQstCw0LXRgiDQsdC10LvRg9GOINC60L3QvtC/0LrRgyBwbGF5XHJcbiAgICBwbGF5QnRuLmNsYXNzTGlzdC50b2dnbGUoXCJ2aWRlb19fcGxheWVyLWltZy0tYWN0aXZlXCIpO1xyXG5cclxuICAgIC8vINC/0YDQvtCy0LXRgNC40Lwg0YHRgtC+0LjRgiDQu9C4INCy0LjQtNC10L4g0L3QsCDQv9Cw0YPQt9C1LCDQtdGB0LvQuCDQtNCwINGC0L4g0L/RgNC+0LTQvtC70LbQuNC8INCy0L7RgdC/0YDQvtC40LfQstC10LTQtdC90LjQtS5cclxuXHJcbiAgICBpZiAodmlkZW8ucGF1c2VkKSB7XHJcbiAgICAgICAgLy8g0LfQsNC/0YPRgdC60LDQtdC8INCy0LjQtNC10L5cclxuICAgICAgICB2aWRlby5wbGF5KCk7XHJcbiAgICAgICAgLy8g0JLQutC70Y7Rh9Cw0LXQvCDRhNGD0L3QutGG0LjRjiDQvtCx0L3QvtCy0LvQtdC90LjRjyDQv9GA0L7Qs9GA0LXRgdGB0LBcclxuICAgICAgICBpbnRlcnZhbElkID0gc2V0SW50ZXJ2YWwodXBkYXRlRHVyYXRpb24sIDEwMDAgLyA2MCk7XHJcbiAgICAgICAgLy8g0L/RgNC10LLRgNCw0YnQsNC10Lwg0LzQsNC70LXQvdGM0LrRg9GOINC60L3QvtC/0LrRgyBwbGF5INCyIHBhdXNlXHJcbiAgICAgICAgcGxheWVyUGxheUJ0bi5jbGFzc0xpc3QuYWRkKCdhY3RpdmUnKTtcclxuICAgICAgICAvLyDQldGB0LvQuCwg0L3QsNC+0LHQvtGA0L7Rgiwg0L/RgNC+0LjQs9GA0YvQsNCy0YvQtdGC0YHRjywg0YLQviDQvtGB0YLQsNC90L7QstC40LwuXHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICAgIC8vINC+0YHRgtCw0L3QsNCy0LvQuNCy0LDQtdC8INCy0LjQtNC10L5cclxuICAgICAgICB2aWRlby5wYXVzZSgpO1xyXG4gICAgICAgIC8vINC+0YHRgtCw0L3QsNCy0LvQuNCy0LDQtdC8INC+0LHQvdC+0LLQu9C10L3QuNC1INC/0YDQvtCz0YDQtdGB0YHQsFxyXG4gICAgICAgIGNsZWFySW50ZXJ2YWwoaW50ZXJ2YWxJZCk7XHJcbiAgICAgICAgLy8g0L/RgNC10LLRgNCw0YnQsNC10Lwg0LzQsNC70LXQvdGM0LrRg9GOINC60L3QvtC/0LrRgyBwYXVzZSDQsiBwbGF5XHJcbiAgICAgICAgcGxheWVyUGxheUJ0bi5jbGFzc0xpc3QucmVtb3ZlKCdhY3RpdmUnKTtcclxuICAgIH1cclxufVxyXG5cclxuLypcclxuICAgINCg0LXQsNC70LjQt9GD0LXRgiDQstC+0LfQvNC+0LbQvdC+0YHRgtGMINC/0LXRgNC10LzQvtGC0LrQuCDQvdCw0YjQtdCz0L4g0LLQuNC00LXQvlxyXG4qL1xyXG5mdW5jdGlvbiBzZXRWaWRlb0R1cmF0aW9uKCkge1xyXG4gICAgLy8g0YPRgdGC0LDQvdC+0LLQuNGC0Ywg0LfQvdCw0YfQtdC90LjQtSDQv9C+0LvQt9GD0L3QutCwINCyINGC0LXQutGD0YnQtdC1INCy0YDQtdC80Y9cclxuICAgIHZpZGVvLmN1cnJlbnRUaW1lID0gZHVyYXRpb25Db250cm9sLnZhbHVlO1xyXG4gICAgdXBkYXRlRHVyYXRpb24oKTtcclxuICAgIC8vIGludGVydmFsSWQgPSBzZXRJbnRlcnZhbCh1cGRhdGVEdXJhdGlvbiwgMTAwMCAvIDYwKTtcclxufVxyXG5cclxuXHJcbi8qXHJcbiAg0KTRg9C90LrRhtC40Y8g0LTQu9GPINC+0LHQvdC+0LLQu9C10L3QuNGPINC/0L7Qt9C40YbQuNC4INC/0L7Qu9C30YPQvdC60LAg0L/RgNC+0LTQvtC70LbQuNGC0LXQu9GM0L3QvtGB0YLQuCDQstC40LTQtdC+LiAgIFxyXG4qL1xyXG5mdW5jdGlvbiB1cGRhdGVEdXJhdGlvbigpIHtcclxuICAgIC8vINGD0YHRgtCw0L3QsNCy0LvQuNCy0LDQtdC8INCyINC90LDRiCDQuNC90L/Rg9GCINGC0LXQutGD0YnQtdC1INCy0YDQtdC80Y9cclxuICAgIGR1cmF0aW9uQ29udHJvbC52YWx1ZSA9IHZpZGVvLmN1cnJlbnRUaW1lO1xyXG4gICAgLy8g0YDQsNGB0YHRh9C40YLRi9Cy0LDQtdC8INC/0YDQvtGG0LXQvdGCINC00LvRjyDQt9Cw0LrRgNCw0YHQutC4INC/0YDQvtCz0YDQtdGB0YHQsFxyXG4gICAgbGV0IHN0ZXAgPSB2aWRlby5kdXJhdGlvbiAvIDEwMDtcclxuICAgIGxldCBwZXJjZW50ID0gdmlkZW8uY3VycmVudFRpbWUgLyBzdGVwO1xyXG4gICAgLy8g0YPRgdGC0LDQvdCw0LLQu9C40LLQsNC10Lwg0YHRgtC40LvQuFxyXG4gICAgZHVyYXRpb25Db250cm9sLnN0eWxlLmJhY2tncm91bmQgPSBgbGluZWFyLWdyYWRpZW50KDkwZGVnLCAjRTAxRjNEIDAlLCAjRTAxRjNEICR7cGVyY2VudH0lLCAjNjI2MjYyICR7cGVyY2VudH0lKWA7XHJcblxyXG59XHJcblxyXG5cclxuLypcclxuICAgINCj0L/RgNCw0LLQu9C10L3QuNC1INC30LLRg9C60L7QvFxyXG4qL1xyXG5mdW5jdGlvbiBzb3VuZE9mKCkge1xyXG4gICAgLypcclxuICAgICAgICDQlNC10LvQsNC10Lwg0L/RgNC+0LLQtdGA0LrRgyDRg9GA0L7QstC90Y8g0LPRgNC+0LzQutC+0YHRgtC4LiBcclxuICAgICAgICDQldGB0LvQuCDRgyDQvdCw0YEg0L3QsNGI0LXQs9C+INCy0LjQtNC10L4g0LXRgdGC0Ywg0LfQstGD0LosINGC0L4g0LzRiyDQtdCz0L4g0LLRi9C60LvRjtGH0LDQtdC8LiBcclxuICAgICAgICDQn9GA0LXQtNCy0LDRgNC40YLQtdC70YzQvdC+INC30LDQv9C+0LzQvdC40LIg0YLQtdC60YPRidGD0Y4g0L/QvtC30LjRhtC40Y4g0LPRgNC+0LzQutC+0YHRgtC4INCyINC/0LXRgNC10LzQtdC90L3Rg9GOIHNvdW5kTGV2ZWxcclxuICAgICovXHJcbiAgICBpZiAodmlkZW8udm9sdW1lID09PSAwKSB7XHJcbiAgICAgICAgdmlkZW8udm9sdW1lID0gc291bmRMZXZlbDtcclxuICAgICAgICBzb3VuZENvbnRyb2wudmFsdWUgPSBzb3VuZExldmVsICogMTA7XHJcbiAgICAgICAgc291bmRCdG4uY2xhc3NMaXN0LnJlbW92ZSgnYWN0aXZlJyk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICAgIC8qXHJcbiAgICAgICAgICAgINCV0YHQu9C4INGDINC90LDRiNC10LPQviDQstC40LTQtdC+INC90LXRgiDQt9Cy0YPQutCwLCDRgtC+INCy0YvRgdGC0LDQstC70Y/QtdC8INGD0YDQvtCy0LXQvdGMINCz0YDQvtC80LrQvtGB0YLQuCDQvdCwINC/0YDQtdC20L3QuNC5INGD0YDQvtCy0LXQvdGMLlxyXG4gICAgICAgICAgICDQpdGA0LDQvdC40YLRgdGPINCyINC/0LXRgNC80LXQvdC90L7QuSBzb3VuZExldmVsXHJcbiAgICAgICAgKi9cclxuICAgICAgICBzb3VuZExldmVsID0gdmlkZW8udm9sdW1lO1xyXG4gICAgICAgIHZpZGVvLnZvbHVtZSA9IDA7XHJcbiAgICAgICAgc291bmRDb250cm9sLnZhbHVlID0gMDtcclxuICAgICAgICBzb3VuZEJ0bi5jbGFzc0xpc3QuYWRkKCdhY3RpdmUnKTtcclxuXHJcbiAgICB9XHJcbn1cclxuXHJcbi8qXHJcbiAgICDQo9C/0YDQsNCy0LvQtdC90LjQtSDQt9Cy0YPQutC+0Lwg0LLQuNC00LXQvlxyXG4qL1xyXG5mdW5jdGlvbiBjaGFuZ2VTb3VuZFZvbHVtZSgpIHtcclxuICAgIC8qXHJcbiAgICAgICAg0KHQsi3QstC+IHZvbHVtZSDQvNC+0LbQtdGCINC/0YDQuNC90LjQvNCw0YLRjCDQt9C90LDRh9C10L3QuNGPINC+0YIgMCDQtNC+IDFcclxuICAgICAgICDQlNC10LvQuNC8INC90LAgMTAg0LTQu9GPINGC0L7Qs9C+INGH0YLQviDQsdGLLCDQsdGL0LvQsCDQstC+0LfQvNC+0LbQvdC+0YHRgtGMINCx0L7Qu9C10LUg0YLQvtGH0L3QvtC5INGA0LXQs9GD0LvQuNGA0L7QstC60Lgg0LLQuNC00LXQvi4gXHJcbiAgIHZpZGVvLnZvbHVtZSAwIC4uLi4gMSBcclxuICAgc291bmRDb250cm9sIDAgLi4uLiAxMFxyXG4gICAgICAgICovXHJcblxyXG4gICAgdmlkZW8udm9sdW1lID0gc291bmRDb250cm9sLnZhbHVlIC8gMTA7XHJcbiAgICBpZiAodmlkZW8udm9sdW1lID09IDApIHtcclxuICAgICAgICBzb3VuZEJ0bi5jbGFzc0xpc3QuYWRkKCdhY3RpdmUnKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgICAgc291bmRCdG4uY2xhc3NMaXN0LnJlbW92ZSgnYWN0aXZlJyk7XHJcbiAgICB9XHJcbiAgICBjb25zb2xlLmxvZygn0LfQvdCw0YfQtdC90LjQtSB2b2x1bWUg0YMg0LLQuNC00LXQviAnICsgdmlkZW8udm9sdW1lKTtcclxuICAgIGNvbnNvbGUubG9nKCfQt9C90LDRh9C10L3QuNC1IHZhbHVlINGDIG1pY0xldmVsICcgKyBzb3VuZENvbnRyb2wudmFsdWUgLyAxMCk7XHJcbiAgICAvKirQoyDQv9C+0LvQt9GD0L3QutCwINC40LfQvdCw0YfQsNC70YzQvdC+INC30LDQtNCw0L3QviDQvNC40L3QuNC80LDQu9GM0L3QvtC1INC30L3QsNGH0LXQvdC40LUgMCDQuCDQvNCw0LrRgdC40LzQsNC70YzQvdC+0LUgMTAg0YfRgtC+0LEg0LTQsNGC0Ywg0L3QsNC8IDEwINC/0L7Qu9C+0LbQtdC90LjQuVxyXG4gICAgICog0YDQtdCz0YPQu9C40YDQvtCy0LrQuFxyXG4gICAgICovXHJcbn1cclxuXHJcbi8v0JrQsNGA0YLQsFxyXG5sZXQgbXlNYXA7XHJcbmNvbnN0IGluaXQgPSAoKSA9PiB7XHJcbiBteU1hcCA9IG5ldyB5bWFwcy5NYXAoXCJtYXBcIiwge1xyXG4gICBjZW50ZXI6IFs1NS43NTIxMzIsIDM3LjYyMjgwN10sXHJcbiAgIHpvb206IDEzLFxyXG4gICBjb250cm9sczogW10sXHJcbiB9KTtcclxuIFxyXG4gbGV0IGNvb3JkcyA9IFtcclxuICAgICBbNTUuNzU5MjExLCAzNy41ODI2MzddLFxyXG4gICAgIFs1NS43NDk2NjIsIDM3LjYwMzg4OV0sXHJcbiAgICAgWzU1Ljc0MzA2OSwgMzcuNTgwOTg3XSxcclxuICAgICBbNTUuNzU2OTE3LCAzNy42MjA2MTldLFxyXG4gICBdLFxyXG4gICBteUNvbGxlY3Rpb24gPSBuZXcgeW1hcHMuR2VvT2JqZWN0Q29sbGVjdGlvbih7fSwge1xyXG4gICAgIGRyYWdnYWJsZTogZmFsc2UsXHJcbiAgICAgaWNvbkxheW91dDogJ2RlZmF1bHQjaW1hZ2UnLFxyXG4gICAgIGljb25JbWFnZUhyZWY6ICcuL2ltZy9pY29ucy9tYXJrZXIuc3ZnJyxcclxuICAgICBpY29uSW1hZ2VTaXplOiBbNTgsIDczXSxcclxuICAgICBpY29uSW1hZ2VPZmZzZXQ6IFstMzUsIC01Ml1cclxuICAgfSk7XHJcbiBcclxuIGZvciAobGV0IGkgPSAwOyBpIDwgY29vcmRzLmxlbmd0aDsgaSsrKSB7XHJcbiAgIG15Q29sbGVjdGlvbi5hZGQobmV3IHltYXBzLlBsYWNlbWFyayhjb29yZHNbaV0pKTtcclxuIH1cclxuIFxyXG4gbXlNYXAuZ2VvT2JqZWN0cy5hZGQobXlDb2xsZWN0aW9uKTtcclxuIFxyXG4gbXlNYXAuYmVoYXZpb3JzLmRpc2FibGUoJ3Njcm9sbFpvb20nKTtcclxufTtcclxuIFxyXG55bWFwcy5yZWFkeShpbml0KTtcclxuXHJcbi8vT25lIHBhZ2Ugc2Nyb2xsXHJcbmNvbnN0IHNlY3Rpb25zID0gJChcInNlY3Rpb25cIik7XHJcbmNvbnN0IGRpc3BsYXkgPSAkKFwiLm1haW5jb250ZW50XCIpO1xyXG5jb25zdCBzaWRlTWVudSA9ICQoXCIuZml4ZWQtbWVudVwiKTtcclxuY29uc3QgbWVudUl0ZW1zID0gc2lkZU1lbnUuZmluZChcIi5maXhlZC1tZW51X19pdGVtXCIpO1xyXG5cclxuY29uc3QgbW9iaWxlRGV0ZWN0ID0gbmV3IE1vYmlsZURldGVjdCh3aW5kb3cubmF2aWdhdG9yLnVzZXJBZ2VudCk7XHJcbmNvbnN0IGlzTW9iaWxlID0gbW9iaWxlRGV0ZWN0Lm1vYmlsZSgpO1xyXG5cclxubGV0IGluU2Nyb2xsID0gZmFsc2U7XHJcblxyXG5zZWN0aW9ucy5maXJzdCgpLmFkZENsYXNzKFwiYWN0aXZlXCIpO1xyXG5cclxuY29uc3QgY291bnRTZWN0aW9uUG9zaXRpb24gPSAoc2VjdGlvbkVxKSA9PiB7XHJcbiAgY29uc3QgcG9zaXRpb24gPSBzZWN0aW9uRXEgKiAtMTAwO1xyXG5cclxuICBpZiAoaXNOYU4ocG9zaXRpb24pKSB7XHJcbiAgICBjb25zb2xlLmVycm9yKFwi0L/QtdGA0LXQtNCw0L3QviDQvdC10LLQtdGA0L3QvtC1INC30L3QsNGH0LXQvdC40LUg0LIgY291bnRTZWN0aW9uUG9zaXRpb25cIik7XHJcbiAgICByZXR1cm4gMDtcclxuICB9XHJcbiAgXHJcbiAgcmV0dXJuIHBvc2l0aW9uO1xyXG59O1xyXG5cclxuY29uc3QgY2hhbmdlTWVudVRoZW1lRm9yU2VjdGlvbiA9IHNlY3Rpb25FcSA9PiB7XHJcbiAgY29uc3QgY3VycmVudFNlY3Rpb24gPSBzZWN0aW9ucy5lcShzZWN0aW9uRXEpO1xyXG4gIGNvbnN0IG1lbnVUaGVtZSA9IGN1cnJlbnRTZWN0aW9uLmF0dHIoXCJkYXRhLXNpZGVtZW51LXRoZW1lXCIpO1xyXG4gIGNvbnN0IGFjdGl2ZUNsYXNzID0gXCJmaXhlZC1tZW51LS1zaGFkb3dlZFwiO1xyXG5cclxuICBpZiAobWVudVRoZW1lID09PSBcIndoaXRlXCIpIHtcclxuICAgIHNpZGVNZW51LmFkZENsYXNzKGFjdGl2ZUNsYXNzKTtcclxuICB9IGVsc2Uge1xyXG4gICAgc2lkZU1lbnUucmVtb3ZlQ2xhc3MoXCJmaXhlZC1tZW51LS1zaGFkb3dlZFwiKTtcclxuICB9XHJcbn07XHJcblxyXG5jb25zdCByZXNldEFjdGl2ZUNsYXNzRm9ySXRlbSA9IChpdGVtcywgaXRlbUVxLCBhY3RpdmVDbGFzcykgPT4ge1xyXG4gIGl0ZW1zLmVxKGl0ZW1FcSkuYWRkQ2xhc3MoYWN0aXZlQ2xhc3MpLnNpYmxpbmdzKCkucmVtb3ZlQ2xhc3MoYWN0aXZlQ2xhc3MpO1xyXG59XHJcblxyXG5jb25zdCBwZXJmb3JtVHJhbnNpdGlvbiA9IChzZWN0aW9uRXEpID0+IHtcclxuICBpZiAoaW5TY3JvbGwpIHJldHVybjtcclxuXHJcbiAgY29uc3QgdHJhbnNpdGlvbk92ZXIgPSAxMDAwO1xyXG4gIGNvbnN0IG1vdXNlSW5lcnRpYU92ZXIgPSAzMDA7XHJcblxyXG4gIGluU2Nyb2xsID0gdHJ1ZTtcclxuXHJcbiAgY29uc3QgcG9zaXRpb24gPSBjb3VudFNlY3Rpb25Qb3NpdGlvbihzZWN0aW9uRXEpO1xyXG5cclxuICBjaGFuZ2VNZW51VGhlbWVGb3JTZWN0aW9uKHNlY3Rpb25FcSk7XHJcblxyXG4gIGRpc3BsYXkuY3NzKHtcclxuICAgIHRyYW5zZm9ybTogYHRyYW5zbGF0ZVkoJHtwb3NpdGlvbn0lKWBcclxuICB9KTtcclxuXHJcbiAgcmVzZXRBY3RpdmVDbGFzc0Zvckl0ZW0oc2VjdGlvbnMsIHNlY3Rpb25FcSwgXCJhY3RpdmVcIik7XHJcblxyXG4gIHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgaW5TY3JvbGwgPSBmYWxzZTtcclxuXHJcbiAgICByZXNldEFjdGl2ZUNsYXNzRm9ySXRlbShtZW51SXRlbXMsIHNlY3Rpb25FcSwgXCJmaXhlZC1tZW51X19pdGVtLS1hY3RpdmVcIik7XHJcbiAgfSwgdHJhbnNpdGlvbk92ZXIgKyBtb3VzZUluZXJ0aWFPdmVyKTtcclxufTtcclxuXHJcbmNvbnN0IHZpZXdwb3J0U2Nyb2xsZXIgPSAoKSA9PiB7XHJcbiAgY29uc3QgYWN0aXZlU2VjdGlvbiA9IHNlY3Rpb25zLmZpbHRlcihcIi5hY3RpdmVcIik7XHJcbiAgY29uc3QgbmV4dFNlY3Rpb24gPSBhY3RpdmVTZWN0aW9uLm5leHQoKTtcclxuICBjb25zdCBwcmV2U2VjdGlvbiA9IGFjdGl2ZVNlY3Rpb24ucHJldigpO1xyXG5cclxuICByZXR1cm4ge1xyXG4gICAgbmV4dCgpIHtcclxuICAgICAgaWYgKG5leHRTZWN0aW9uLmxlbmd0aCkge1xyXG4gICAgICAgIHBlcmZvcm1UcmFuc2l0aW9uKG5leHRTZWN0aW9uLmluZGV4KCkpXHJcbiAgICAgIH1cclxuICAgIH0sXHJcbiAgICBwcmV2KCkge1xyXG4gICAgICBpZiAocHJldlNlY3Rpb24ubGVuZ3RoKSB7XHJcbiAgICAgICAgcGVyZm9ybVRyYW5zaXRpb24ocHJldlNlY3Rpb24uaW5kZXgoKSlcclxuICAgICAgfVxyXG4gICAgfSxcclxuICB9O1xyXG59O1xyXG5cclxuJCh3aW5kb3cpLm9uKFwid2hlZWxcIiwgZSA9PiB7XHJcbiAgY29uc3QgZGVsdGFZID0gZS5vcmlnaW5hbEV2ZW50LmRlbHRhWTtcclxuICBjb25zdCBzY3JvbGxlciA9IHZpZXdwb3J0U2Nyb2xsZXIoKTtcclxuXHJcbiAgaWYgKGRlbHRhWSA+IDApIHtcclxuICAgIHNjcm9sbGVyLm5leHQoKTtcclxuICB9XHJcblxyXG4gIGlmIChkZWx0YVkgPCAwKSB7XHJcbiAgICBzY3JvbGxlci5wcmV2KCk7XHJcbiAgfVxyXG59KTtcclxuXHJcbiQod2luZG93KS5vbihcImtleWRvd25cIiwgZSA9PiB7XHJcbiAgY29uc3QgdGFnTmFtZSA9IGUudGFyZ2V0LnRhZ05hbWUudG9Mb3dlckNhc2UoKTtcclxuICBjb25zdCB1c2VyVHlwaW5nSW5JbnB1dHMgPSB0YWdOYW1lID09PSBcImlucHV0XCIgfHwgdGFnTmFtZSA9PT0gXCJ0ZXh0YXJlYVwiO1xyXG4gIGNvbnN0IHNjcm9sbGVyID0gdmlld3BvcnRTY3JvbGxlcigpO1xyXG5cclxuICBpZiAodXNlclR5cGluZ0luSW5wdXRzKSByZXR1cm47XHJcblxyXG4gIHN3aXRjaCAoZS5rZXlDb2RlKSB7XHJcbiAgICBjYXNlIDM4OiAvL3ByZXZcclxuICAgIHNjcm9sbGVyLnByZXYoKTtcclxuICAgICAgYnJlYWs7XHJcbiAgXHJcbiAgICBjYXNlIDQwOiAvL25leHRcclxuICAgICAgc2Nyb2xsZXIubmV4dCgpO1xyXG4gICAgICBicmVhaztcclxuICB9XHJcbn0pO1xyXG5cclxuJChcIi53cmFwcGVyXCIpLm9uKFwidG91Y2htb3ZlXCIsIGUgPT4gZS5wcmV2ZW50RGVmYXVsdCgpKTtcclxuXHJcbiQoXCJbZGF0YS1zY3JvbGwtdG9dXCIpLmNsaWNrKGUgPT4ge1xyXG4gIGUucHJldmVudERlZmF1bHQoKTtcclxuXHJcbiAgY29uc3QgJHRoaXMgPSAkKGUuY3VycmVudFRhcmdldCk7XHJcbiAgY29uc3QgdGFyZ2V0ID0gJHRoaXMuYXR0cihcImRhdGEtc2Nyb2xsLXRvXCIpO1xyXG4gIGNvbnN0IHJlcVNlY3Rpb24gPSAkKGBbZGF0YS1zZWN0aW9uLWlkPSR7dGFyZ2V0fV1gKTtcclxuXHJcbiAgcGVyZm9ybVRyYW5zaXRpb24ocmVxU2VjdGlvbi5pbmRleCgpKTtcclxufSlcclxuXHJcbmlmIChpc01vYmlsZSkge1xyXG4gICQoXCJib2R5XCIpLnN3aXBlKHtcclxuICAgIHN3aXBlOiBmdW5jdGlvbiAoZXZlbnQsIGRpcmVjdGlvbikge1xyXG4gICAgICBjb25zdCBzY3JvbGxlciA9IHZpZXdwb3J0U2Nyb2xsZXIoKTtcclxuICAgICAgbGV0IHNjcm9sbERpcmVjdGlvbiA9IFwiXCI7XHJcbiAgXHJcbiAgICAgIGlmIChkaXJlY3Rpb24gPT09IFwidXBcIikgc2Nyb2xsRGlyZWN0aW9uID0gXCJuZXh0XCI7XHJcbiAgICAgIGlmIChkaXJlY3Rpb24gPT09IFwiZG93blwiKSBzY3JvbGxEaXJlY3Rpb24gPSBcInByZXZcIjtcclxuXHJcbiAgICAgIGlmIChzY3JvbGxEaXJlY3Rpb24gPT0gXCJuZXh0XCIgfHwgc2Nyb2xsRGlyZWN0aW9uID09IFwicHJldlwiKSB7XHJcbiAgICAgICAgc2Nyb2xsZXJbc2Nyb2xsRGlyZWN0aW9uXSgpOyAgXHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9KTtcclxufSJdfQ==
